<!DOCTYPE html>
<html lang="zh-cn">
 <head> 
  <meta charset="utf-8" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1" /> 
  <title>AOP解析――含简单AOP框架实现（包括Proxy模式实现与Attribute实现）实现Castle的AR事务低侵入性 - pangxiaoliang[北京]流浪者 - 博客园</title> 
  <link type="text/css" rel="stylesheet" href="/bundles/blog-common.css?v=m_FXmwz3wxZoecUwNEK23PAzc-j9vbX_C6MblJ5ouMc1" /> 
  <link id="MainCss" type="text/css" rel="stylesheet" href="/skins/SimpleBlue/bundle-SimpleBlue.css?v=jJERBFSojhmgst84aaRDal9S3q1WoO-WcNudmMzGJS81" /> 
  <link id="mobile-style" media="only screen and (max-width: 768px)" type="text/css" rel="stylesheet" href="/skins/SimpleBlue/bundle-SimpleBlue-mobile.css?v=z0BacpCfWeLlXDCM0C158kTP_DMqMbGBapID4f-QztI1" /> 
  <link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/pangxiaoliang/rss" /> 
  <link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/pangxiaoliang/rsd.xml" /> 
  <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/pangxiaoliang/wlwmanifest.xml" /> 
  <script src="//common.cnblogs.com/script/jquery.js" type="text/javascript"></script> 
  <script type="text/javascript">var currentBlogApp = 'pangxiaoliang', cb_enable_mathjax=false;var isLogined=false;</script> 
  <script src="/bundles/blog-common.js?v=HjE8xh24aOra0V_HP38wxIHV3lfHC5polwLAK3mmjdg1" type="text/javascript"></script> 
 </head> 
 <body> 
  <a name="top"></a> 
  <!--PageBeginHtml Block Begin--> 
  <div style="text-align: right">
    一颗不安分的创业心 
  </div> 
  <!--PageBeginHtml Block End--> 
  <div id="home"> 
   <div id="header"> 
    <div id="blogTitle"> 
     <!--done--> 
     <div class="title">
      <a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/pangxiaoliang/">pangxiaoliang[北京]流浪者――庞晓亮</a>
     </div> 
     <div class="subtitle">
      卖水果的架构师
     </div> 
    </div>
    <!--end: blogTitle 博客的标题和副标题 --> 
    <div id="navigator"> 
     <ul id="navList"> 
      <li id="nav_sitehome"><a id="blog_nav_sitehome" class="menu" href="http://www.cnblogs.com/">博客园</a></li> 
      <li id="nav_myhome"></li> 
      <li id="nav_newpost"><a id="blog_nav_newpost" class="menu" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li> 
      <li id="nav_contact"><a id="blog_nav_contact" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/pangxiaoliang%5B%E5%8C%97%E4%BA%AC%5D%E6%B5%81%E6%B5%AA%E8%80%85">联系</a></li> 
      <li id="nav_rss"><a id="blog_nav_rss" class="menu" href="http://www.cnblogs.com/pangxiaoliang/rss">订阅</a> 
       <!--<a id="blog_nav_rss_image" class="aHeaderXML" href="http://www.cnblogs.com/pangxiaoliang/rss"><img src="//www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li> 
      <li id="nav_admin"><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li> 
     </ul> 
     <div class="blogStats"> 
      <div id="blog_stats"> 
       <!--done--> 随笔-45&nbsp; 文章-3&nbsp; 评论-122&nbsp; 
      </div> 
     </div>
     <!--end: blogStats --> 
    </div>
    <!--end: navigator 博客导航栏 --> 
   </div>
   <!--end: header 头部 --> 
   <div id="main"> 
    <div id="mainContent"> 
     <div class="forFlow"> 
      <div id="post_detail"> 
       <!--done--> 
       <div id="topics"> 
        <div class="post"> 
         <h1 class="postTitle"> <a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/pangxiaoliang/archive/2010/03/09/1680673.html">AOP解析――含简单AOP框架实现（包括Proxy模式实现与Attribute实现）实现Castle的AR事务低侵入性</a> </h1> 
         <div class="clear"></div> 
         <div class="postBody"> 
          <div id="cnblogs_post_body">
           <p><span style="color: #339966">AOP简介：</span></p> 
           <p>AOP（Aspect Oriented Programming）“面向切面编程”，其实和OOP（<font size="2">Object Oriented Programming</font>）“面向对象编程”一样是一种编程思路，而且个人以为翻译为“切面导向编程”更为妥当，OOP也应翻译为“对象导向编程”。因为正是有了“切面”和“对象”的想法和概念才产生了“Aspect Oriented Programming”和“<font size="2">Object Oriented Programming”这些编程方法，所以“导向”更为贴近些</font>。</p> 
           <p>以下想法均为个人揣摩得出，具体官方概念请Google，Bing，Baidu.</p> 
           <p>AOP，个人以为是一种行为（Behavior）的注入，在不改变原有逻辑（original logic）的基础上，将一些可重用的其他逻辑（other logic）注入到原有逻辑（original logic）中。切面(Aspect)即为其他逻辑（other logic），是一些特殊的业务关注点，包括“事务处理”，“异常捕捉”，“日志记录”，“身份验证”等方面。</p> 
           <p>这种“切面”逻辑一般贯彻整个解决方案，AOP方式将这种切面提取出来，实现了解耦和代码简洁化。</p> 
           <p><span style="color: #339966">简单例子：</span></p> 
           <p><span style="color: #339966"></span>下面举个简单的例子来说明<span style="color: red">为什么要使用AOP：</span></p> 
           <p>1）没有使用AOP的Castle ActiveRecord“事务处理”</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('11b777e1-fb18-4981-a570-8a26b5b775e3')">
            <img style="display: none" id="code_img_closed_11b777e1-fb18-4981-a570-8a26b5b775e3" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_11b777e1-fb18-4981-a570-8a26b5b775e3" class="code_img_opened" onclick="cnblogs_code_hide('11b777e1-fb18-4981-a570-8a26b5b775e3',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_11b777e1-fb18-4981-a570-8a26b5b775e3"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;AOPTest<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;......</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Save&nbsp;the&nbsp;retire&nbsp;user&nbsp;info.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;param&nbsp;name=&quot;site&quot;&gt;</span>
              <span style="color: #008000">The&nbsp;user will be <font color="#008000">retire&nbsp;user</font>.</span>
              <span style="color: #808080">&lt;/param&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;SaveRetireUserInfo(User&nbsp;user)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">(TransactionScope&nbsp;transaction&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;TransactionScope())<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">try</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RetireUser&nbsp;retireUser&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;RetireUser();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retireUser.Name&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;user.Name;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retireUser.Department&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;user.Department;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;...</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.Delete();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retireUser.Save();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transaction.VoteCommit();&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">完成事务</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">catch</span>
              <span style="color: #000000">(Exception&nbsp;ex)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Log.Write(ex.Message);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transaction.VoteRollBack();&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">事务回滚</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;......</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">}</span>
             </div>
            </div>
           </div> 
           <p>&nbsp;2）使用AOP的Castle ActiveRecord“事务处理”, 里边使用了我自己写的精简AOP框架，与原来的文章一样，看不懂没关系，这里只是个宏观的概念。重点在demo分析。</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('2b432cd3-78a1-4f08-ab00-ff411bc265f9')">
            <img style="display: none" id="code_img_closed_2b432cd3-78a1-4f08-ab00-ff411bc265f9" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_2b432cd3-78a1-4f08-ab00-ff411bc265f9" class="code_img_opened" onclick="cnblogs_code_hide('2b432cd3-78a1-4f08-ab00-ff411bc265f9',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_2b432cd3-78a1-4f08-ab00-ff411bc265f9"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;test&nbsp;class&nbsp;for&nbsp;AOP&nbsp;use&nbsp;attribute&nbsp;for&nbsp;transaction.<br /></span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">[AOPProxy(Interception&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">typeof</span>
              <span style="color: #000000">(TransactionInterception))]<br /></span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;AOPTest&nbsp;:&nbsp;ContextBoundObject<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;......</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Save&nbsp;the&nbsp;retire&nbsp;user&nbsp;info.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;param&nbsp;name=&quot;site&quot;&gt;</span>
              <span style="color: #008000">The&nbsp;user&nbsp;will&nbsp;be&nbsp;retire&nbsp;user.</span>
              <span style="color: #808080">&lt;/param&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;SaveRetireUserInfo(User&nbsp;user)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RetireUser&nbsp;retireUser&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;RetireUser();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retireUser.Name&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;user.Name;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retireUser.Department&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;user.Department;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;...</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.Delete();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retireUser.Save();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;......</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">}<br /><br /></span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;interception&nbsp;of&nbsp;the&nbsp;AOP&nbsp;for&nbsp;trasaction.<br /></span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;TransactionInterception&nbsp;:&nbsp;IInterception<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">private</span>
              <span style="color: #000000">&nbsp;TransactionScope&nbsp;transaction&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">null</span>
              <span style="color: #000000">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#region</span>
              <span style="color: #000000">&nbsp;IInterception&nbsp;Members</span>
              <span style="color: #000000"><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;ExceptionHandle()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transaction.VoteRollBack();&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">事务回滚</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;PostInvoke()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transaction.VoteCommit();&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">完成事务&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;PreInvoke()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transaction&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;TransactionScope();&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">初始化事务</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#endregion</span>
              <span style="color: #000000"><br />}</span>
             </div>
            </div>
           </div> 
           <p>由以上可见，加入AOP后（AOPProxy Attribute实现），“其他逻辑”注入“原始逻辑”使得代码更加简洁，同时也将“切面”的逻辑和“业务”的逻辑分离开来，实现了解耦。TransactionInterception是拦截器，实现了“其他逻辑”，由AOPProxy Attribute通过type将其注入。在处理“原始逻辑”的时候会同时处理注入的“其他逻辑”。ExceptionHandle方法实现出现Exception时的“其他逻辑”注入；PreInvoke方法实现在调用“主题”方法前的“其他逻辑”注入；PostInvoke方法实现在调用“主题”方法后的“其他逻辑”注入。</p> 
           <p>简单来说执行流程如下：</p> 
           <p>1. PreInvoke();</p> 
           <p>2. 主题Method();</p> 
           <p>3. </p> 
           <p>if(调用&quot;主题Method()&quot;时出现Exception)<br />{</p> 
           <p>&nbsp;&nbsp;&nbsp;&nbsp; ExceptionHandle();<br />}</p> 
           <p>else</p> 
           <p>{</p> 
           <p>&nbsp;&nbsp;&nbsp;&nbsp; PostInvoke();<br />}</p> 
           <p>有下面的SaveRetireUserInfo方法可以看到“业务逻辑”变得简洁，在“业务逻辑”已经见不到扰乱代码可读性的“事务代码”和“try...catch...”语句块了，只需要给该类加上“AOPProxy”特性注入相应的“拦截器”并继承ContextBoundObject即可。</p> 
           <p><span style="color: #0000ff">public</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">void</span><span style="color: #000000">&nbsp;SaveRetireUserInfo(User&nbsp;user)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RetireUser&nbsp;retireUser&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;</span><span style="color: #0000ff">new</span><span style="color: #000000">&nbsp;RetireUser();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retireUser.Name&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;user.Name;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retireUser.Department&nbsp;</span><span style="color: #000000">=</span><span style="color: #000000">&nbsp;user.Department;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #008000">//</span><span style="color: #008000">&nbsp;...</span><span style="color: #008000"><br /></span><span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.Delete();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retireUser.Save();<br />&nbsp;}</span></p> 
           <p><span style="color: #339966">Proxy基础:</span></p> 
           <p>代理模式，说白了就是设置一个“中间层”（proxy），把对实际要操作的“主题”保护在里边，并且在操作时进行额外的操作，实现注入。对“主题”的操作均需要通过proxy来完成，就如同经济人。</p> 
           <p>比如：你是著名歌星SexyBaby，你有一个经纪人叫Underdog，你只负责唱歌，各种演唱会的举办和电视台对你邀请一律由Underdog负责，你SexyBaby就是“主题”而你的经纪人Underdog就是proxy。</p> 
           <p>具体的代理模式可以看我以前写的关于Dota的设计模式随笔和各种设计模式书籍。</p> 
           <p>下面介绍个简单的例子来了解下代理模式。</p> 
           <p><span style="color: red">假设一个场景：IT界优秀人士均喜欢看AV，而由于为了保护我们国家未成年人幼小的心灵不受到不良网站侵害，国家屏蔽了AV站点，那我们这些IT界寂寞哥又有这样的需求，那该怎么办那？我们需要通过Online Web Proxy来解决这个问题，我们通过这样的“在线代理网站”（“在线代理网站”服务器放在不屏蔽AV站点的国家，由“在线代理网站”服务器间接访问AV站点。因为在线代理网站不直接提供AV信息，所以我们是可以访问的）来访问AV站点就可以了。这时我们是通过Proxy（“在线代理网站”）访问到“主题”（AV站点），对Proxy（“在线代理网站”）的操作和直接操作“主题”（AV站点）没有什么区别。</span></p> 
           <p>&nbsp;下面就开始我们的AV之旅吧，由于上次有同学说我代码里用中文，怪怪的，这次都用英文，顺便让大家复习下英文了:</p> 
           <p>1) 首先我们必须有一台链接到Internet的电脑“MyComputer”。&nbsp;</p> 
           <p>&nbsp;</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('d0095a57-f392-4f66-96be-37dda7c3a93f')">
            <img style="display: none" id="code_img_closed_d0095a57-f392-4f66-96be-37dda7c3a93f" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_d0095a57-f392-4f66-96be-37dda7c3a93f" class="code_img_opened" onclick="cnblogs_code_hide('d0095a57-f392-4f66-96be-37dda7c3a93f',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_d0095a57-f392-4f66-96be-37dda7c3a93f"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.ProxyPattern<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;My&nbsp;PC.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;MyComputer<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Visit&nbsp;the&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;param&nbsp;name=&quot;site&quot;&gt;</span>
              <span style="color: #008000">The&nbsp;site.</span>
              <span style="color: #808080">&lt;/param&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;Visit(ISite&nbsp;site)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Green;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">Site&nbsp;Url:{0}</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">,&nbsp;site.Url);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.White;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IFilter&nbsp;filter&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;ChinaDNSFilter();&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Server&nbsp;in&nbsp;China,&nbsp;comply&nbsp;with&nbsp;the&nbsp;rule&nbsp;of&nbsp;China.</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;site&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;filter.Parse(site);&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Parse&nbsp;the&nbsp;site.</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Gray;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;site.ShowInformation();&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Show&nbsp;the&nbsp;information&nbsp;of&nbsp;the&nbsp;site.</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.White;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>&nbsp;<span style="color: red">“MyComputer”有一个Visit方法，可以访问到传入的ISite（抽象出的站点接口），Visit方法流程如下：</span></p> 
           <p>1） 输出当前站点ISite的Url。下面的Code是ISite的定义。</p> 
           <p>&nbsp;</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('f7912f7d-0128-4e44-8a0f-51ef20777bc8')">
            <img style="display: none" id="code_img_closed_f7912f7d-0128-4e44-8a0f-51ef20777bc8" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_f7912f7d-0128-4e44-8a0f-51ef20777bc8" class="code_img_opened" onclick="cnblogs_code_hide('f7912f7d-0128-4e44-8a0f-51ef20777bc8',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_f7912f7d-0128-4e44-8a0f-51ef20777bc8"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.ProxyPattern<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;interface&nbsp;of&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">interface</span>
              <span style="color: #000000">&nbsp;ISite<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;url&nbsp;of&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">string</span>
              <span style="color: #000000">&nbsp;Url<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">get</span>
              <span style="color: #000000">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Show&nbsp;the&nbsp;information&nbsp;about&nbsp;this&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;ShowInformation();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>另外我们设计了几个站点以供访问，代码如下：</p> 
           <p>首先是传说中的AVSite（<span style="color: #800000"><a href="http://www.avsite.com/" target="_blank">http://www.avsite.com/</a></span>），看看介绍多么吸引人“<span style="color: #800000">The&nbsp;site&nbsp;is&nbsp;so&nbsp;hot,&nbsp;all&nbsp;AV&nbsp;stars.</span>”。</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('890ecc9e-b05f-44bc-9ed2-a721a12c607c')">
            <img style="display: none" id="code_img_closed_890ecc9e-b05f-44bc-9ed2-a721a12c607c" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_890ecc9e-b05f-44bc-9ed2-a721a12c607c" class="code_img_opened" onclick="cnblogs_code_hide('890ecc9e-b05f-44bc-9ed2-a721a12c607c',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_890ecc9e-b05f-44bc-9ed2-a721a12c607c"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.ProxyPattern<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;site&nbsp;contains&nbsp;AV&nbsp;information.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;AVSite&nbsp;:&nbsp;ISite<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#region</span>
              <span style="color: #000000">&nbsp;ISite&nbsp;Members</span>
              <span style="color: #000000"><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;url&nbsp;of&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">string</span>
              <span style="color: #000000">&nbsp;Url<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">get</span>
              <span style="color: #000000">&nbsp;{&nbsp;</span>
              <span style="color: #0000ff">return</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">http://www.AVSite.com</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Show&nbsp;the&nbsp;information&nbsp;about&nbsp;this&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;ShowInformation()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">The&nbsp;site&nbsp;is&nbsp;so&nbsp;hot,&nbsp;all&nbsp;AV&nbsp;stars.</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#endregion</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>然后是我们经常上的博客园“<span style="color: #800000">http://www.cnblogs.com</span>”，介绍“<span style="color: #800000">The&nbsp;technology&nbsp;site,&nbsp;the&nbsp;home&nbsp;of&nbsp;coders.</span>”。</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('5f0fb7a7-a347-438c-af20-88c685a63a9b')">
            <img style="display: none" id="code_img_closed_5f0fb7a7-a347-438c-af20-88c685a63a9b" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_5f0fb7a7-a347-438c-af20-88c685a63a9b" class="code_img_opened" onclick="cnblogs_code_hide('5f0fb7a7-a347-438c-af20-88c685a63a9b',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_5f0fb7a7-a347-438c-af20-88c685a63a9b"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.ProxyPattern<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;site&nbsp;of&nbsp;cnblogs.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;CnblogsSite&nbsp;:&nbsp;ISite<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#region</span>
              <span style="color: #000000">&nbsp;ISite&nbsp;Members</span>
              <span style="color: #000000"><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;url&nbsp;of&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">string</span>
              <span style="color: #000000">&nbsp;Url<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">get</span>
              <span style="color: #000000">&nbsp;{&nbsp;</span>
              <span style="color: #0000ff">return</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">http://www.cnblogs.com</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Show&nbsp;the&nbsp;information&nbsp;about&nbsp;this&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;ShowInformation()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">The&nbsp;technology&nbsp;site,&nbsp;the&nbsp;home&nbsp;of&nbsp;coders.</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#endregion</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>下面该我们的主角出场了，“在线代理网站”“<span style="color: #800000">http://www.myproxy.com</span>”。我们可以通过构造函数传入想要代理访问的站点地址，传入站点地址后会通过DNS解析访问到相应的网站。“在线代理网站”和“DNS（Domain Name Resolution）”的实现（执行“在线代理网站”的ShowInformation方法时实际是通过代理显示要代理网站（AV站点）的信息）。</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('ed23a208-cdf0-4615-88b9-39a82c49a0c0')">
            <img style="display: none" id="code_img_closed_ed23a208-cdf0-4615-88b9-39a82c49a0c0" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_ed23a208-cdf0-4615-88b9-39a82c49a0c0" class="code_img_opened" onclick="cnblogs_code_hide('ed23a208-cdf0-4615-88b9-39a82c49a0c0',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_ed23a208-cdf0-4615-88b9-39a82c49a0c0"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.ProxyPattern<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;online&nbsp;web&nbsp;proxy&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;MyProxySite&nbsp;:&nbsp;ISite<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">private</span>
              <span style="color: #000000">&nbsp;ISite&nbsp;_site&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">null</span>
              <span style="color: #000000">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;MyProxySite(</span>
              <span style="color: #0000ff">string</span>
              <span style="color: #000000">&nbsp;url)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_site&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;DNS.GetSite(url);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#region</span>
              <span style="color: #000000">&nbsp;ISite&nbsp;Members</span>
              <span style="color: #000000"><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;url&nbsp;of&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">string</span>
              <span style="color: #000000">&nbsp;Url<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">get</span>
              <span style="color: #000000">&nbsp;{&nbsp;</span>
              <span style="color: #0000ff">return</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">http://www.myproxy.com</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Show&nbsp;the&nbsp;information&nbsp;about&nbsp;this&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;ShowInformation()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Green;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">Proxy&nbsp;start!</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">Real&nbsp;url:{0}</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">,&nbsp;_site.Url);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Gray;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IFilter&nbsp;filter&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;USADNSFilter();&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Server&nbsp;in&nbsp;USA,&nbsp;comply&nbsp;with&nbsp;the&nbsp;rule&nbsp;of&nbsp;USA.</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_site&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;filter.Parse(_site);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_site.ShowInformation();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Green;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">Proxy&nbsp;end!</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Gray;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#endregion</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>DNS</p> 
           <p>&nbsp;</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('7a92715b-8296-4a30-9ecc-627fcbd4d4a6')">
            <img style="display: none" id="code_img_closed_7a92715b-8296-4a30-9ecc-627fcbd4d4a6" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_7a92715b-8296-4a30-9ecc-627fcbd4d4a6" class="code_img_opened" onclick="cnblogs_code_hide('7a92715b-8296-4a30-9ecc-627fcbd4d4a6',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_7a92715b-8296-4a30-9ecc-627fcbd4d4a6"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.ProxyPattern<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Domain&nbsp;name&nbsp;resolution.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;DNS<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Get&nbsp;the&nbsp;site&nbsp;instance&nbsp;by&nbsp;the&nbsp;url.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;param&nbsp;name=&quot;url&quot;&gt;</span>
              <span style="color: #008000">The&nbsp;visited&nbsp;url.</span>
              <span style="color: #808080">&lt;/param&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;returns&gt;</span>
              <span style="color: #008000">The&nbsp;site&nbsp;instance.</span>
              <span style="color: #808080">&lt;/returns&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">static</span>
              <span style="color: #000000">&nbsp;ISite&nbsp;GetSite(</span>
              <span style="color: #0000ff">string</span>
              <span style="color: #000000">&nbsp;url)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ISite&nbsp;site&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">null</span>
              <span style="color: #000000">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">if</span>
              <span style="color: #000000">&nbsp;(url&nbsp;</span>
              <span style="color: #000000">==</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">http://www.AVSite.com</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;site&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;AVSite();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">else</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">if</span>
              <span style="color: #000000">&nbsp;(url&nbsp;</span>
              <span style="color: #000000">==</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">http://www.cnblogs.com</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;site&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;CnblogsSite();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">else</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;site&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;NullSite();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">return</span>
              <span style="color: #000000">&nbsp;site;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span>
             </div>
            </div>
           </div> 
           <p>&nbsp;另外当DNS中不包含传入的网址时要返回“NullSite”，用“MyComputer”直接访问“AVSite”时，会被“ChinaFilter”过滤，返回“WarnningSite”提醒访问者触犯法律。“NullSite”和“WarnningSite”实现如下。</p> 
           <p>NullSite：</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('f1b264c7-ed2b-4212-9902-ffdc49c3167d')">
            <img style="display: none" id="code_img_closed_f1b264c7-ed2b-4212-9902-ffdc49c3167d" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_f1b264c7-ed2b-4212-9902-ffdc49c3167d" class="code_img_opened" onclick="cnblogs_code_hide('f1b264c7-ed2b-4212-9902-ffdc49c3167d',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_f1b264c7-ed2b-4212-9902-ffdc49c3167d"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.ProxyPattern<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;site&nbsp;with&nbsp;nothing.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;NullSite&nbsp;:&nbsp;ISite<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#region</span>
              <span style="color: #000000">&nbsp;ISite&nbsp;Members</span>
              <span style="color: #000000"><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;url&nbsp;of&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">string</span>
              <span style="color: #000000">&nbsp;Url<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">get</span>
              <span style="color: #000000">&nbsp;{&nbsp;</span>
              <span style="color: #0000ff">return</span>
              <span style="color: #000000">&nbsp;String.Empty;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Show&nbsp;the&nbsp;information&nbsp;about&nbsp;this&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;ShowInformation()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">No&nbsp;site,&nbsp;please&nbsp;check&nbsp;the&nbsp;url.</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#endregion</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>WarnningSite：</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('35649c37-66f4-48e0-9603-d0921591b4a8')">
            <img style="display: none" id="code_img_closed_35649c37-66f4-48e0-9603-d0921591b4a8" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_35649c37-66f4-48e0-9603-d0921591b4a8" class="code_img_opened" onclick="cnblogs_code_hide('35649c37-66f4-48e0-9603-d0921591b4a8',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_35649c37-66f4-48e0-9603-d0921591b4a8"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.ProxyPattern<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;site&nbsp;for&nbsp;the&nbsp;warnning&nbsp;of&nbsp;gov.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;WarnningSite&nbsp;:&nbsp;ISite<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#region</span>
              <span style="color: #000000">&nbsp;ISite&nbsp;Members</span>
              <span style="color: #000000"><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;url&nbsp;of&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">string</span>
              <span style="color: #000000">&nbsp;Url<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">get</span>
              <span style="color: #000000">&nbsp;{&nbsp;</span>
              <span style="color: #0000ff">return</span>
              <span style="color: #000000">&nbsp;String.Empty;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Show&nbsp;the&nbsp;information&nbsp;about&nbsp;this&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;ShowInformation()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">For&nbsp;the&nbsp;gov&nbsp;rule,&nbsp;this&nbsp;site&nbsp;can't&nbsp;be&nbsp;visited.</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#endregion</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>2） 根据中国法律由ISP（Internat Service Provider）服务器过滤网站，返回相应的站点对象。</p> 
           <p>过滤接口实现如下：</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('27086103-59ad-4784-8dcc-b3289ac46f57')">
            <img style="display: none" id="code_img_closed_27086103-59ad-4784-8dcc-b3289ac46f57" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_27086103-59ad-4784-8dcc-b3289ac46f57" class="code_img_opened" onclick="cnblogs_code_hide('27086103-59ad-4784-8dcc-b3289ac46f57',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_27086103-59ad-4784-8dcc-b3289ac46f57"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.ProxyPattern<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;interface&nbsp;of&nbsp;the&nbsp;site&nbsp;visiting&nbsp;filter.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">interface</span>
              <span style="color: #000000">&nbsp;IFilter<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Parse&nbsp;the&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;param&nbsp;name=&quot;site&quot;&gt;</span>
              <span style="color: #008000">The&nbsp;site.</span>
              <span style="color: #808080">&lt;/param&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;returns&gt;</span>
              <span style="color: #008000">The&nbsp;new&nbsp;site.</span>
              <span style="color: #808080">&lt;/returns&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ISite&nbsp;Parse(ISite&nbsp;site);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>中国过滤器，过滤掉AVSite，过滤后返回WarnningSite，实现如下：</p> 
           <p>&nbsp;</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('e2e6a0c9-c86c-4dfe-b34d-bb0ac30fe740')">
            <img style="display: none" id="code_img_closed_e2e6a0c9-c86c-4dfe-b34d-bb0ac30fe740" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_e2e6a0c9-c86c-4dfe-b34d-bb0ac30fe740" class="code_img_opened" onclick="cnblogs_code_hide('e2e6a0c9-c86c-4dfe-b34d-bb0ac30fe740',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_e2e6a0c9-c86c-4dfe-b34d-bb0ac30fe740"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.ProxyPattern<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;ISP(Internet&nbsp;Service&nbsp;Provider),filter&nbsp;the&nbsp;visited&nbsp;site&nbsp;information&nbsp;for&nbsp;comply&nbsp;the&nbsp;rule&nbsp;of&nbsp;China.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;ChinaDNSFilter&nbsp;:&nbsp;IFilter<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#region</span>
              <span style="color: #000000">&nbsp;IFilter&nbsp;Members</span>
              <span style="color: #000000"><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Parse&nbsp;the&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;param&nbsp;name=&quot;site&quot;&gt;</span>
              <span style="color: #008000">The&nbsp;site.</span>
              <span style="color: #808080">&lt;/param&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;returns&gt;</span>
              <span style="color: #008000">The&nbsp;new&nbsp;site.</span>
              <span style="color: #808080">&lt;/returns&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;ISite&nbsp;Parse(ISite&nbsp;site)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;For&nbsp;the&nbsp;children,&nbsp;no&nbsp;AV&nbsp;information.</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ISite&nbsp;returnSite&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;site;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">if</span>
              <span style="color: #000000">&nbsp;(site&nbsp;</span>
              <span style="color: #0000ff">is</span>
              <span style="color: #000000">&nbsp;AVSite)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;returnSite&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;WarnningSite();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">return</span>
              <span style="color: #000000">&nbsp;returnSite;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#endregion</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>美国过滤器，不过滤AVSite，直接返回AVSite，实现如下：</p> 
           <p>&nbsp;</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('71464333-bcd1-4be9-865f-f126e4ec5549')">
            <img style="display: none" id="code_img_closed_71464333-bcd1-4be9-865f-f126e4ec5549" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_71464333-bcd1-4be9-865f-f126e4ec5549" class="code_img_opened" onclick="cnblogs_code_hide('71464333-bcd1-4be9-865f-f126e4ec5549',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_71464333-bcd1-4be9-865f-f126e4ec5549"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.ProxyPattern<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;ISP(Internet&nbsp;Service&nbsp;Provider),filter&nbsp;the&nbsp;visited&nbsp;site&nbsp;information&nbsp;for&nbsp;comply&nbsp;the&nbsp;rule&nbsp;of&nbsp;USA.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;USADNSFilter&nbsp;:&nbsp;IFilter<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#region</span>
              <span style="color: #000000">&nbsp;IFilter&nbsp;Members</span>
              <span style="color: #000000"><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Parse&nbsp;the&nbsp;site.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;param&nbsp;name=&quot;site&quot;&gt;</span>
              <span style="color: #008000">The&nbsp;site.</span>
              <span style="color: #808080">&lt;/param&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;returns&gt;</span>
              <span style="color: #008000">The&nbsp;new&nbsp;site.</span>
              <span style="color: #808080">&lt;/returns&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;ISite&nbsp;Parse(ISite&nbsp;site)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Freedom,&nbsp;no&nbsp;filter.</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">return</span>
              <span style="color: #000000">&nbsp;site;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#endregion</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>&nbsp;</p> 
           <p>3） 通过_site.ShowInformation显示站点信息。</p> 
           <p>虚拟Internat已经搭建起来，可以进行测试啦。</p> 
           <p><span style="color: #339966">首先用“MyComputer”直接访问AVSite，返回WarnningSite:</span></p> 
           <p>&nbsp;MyComputer myComputer = new MyComputer();<br />&nbsp;ISite site = new AVSite();<br />&nbsp;myComputer.Visit(site); // Visit AV site will be return warning.</p> 
           <p>结果：</p> 
           <p><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/pangxiaoliang/DirectlyAVSite.jpg" width="382" height="49" /></p> 
           <p><span style="color: #339966">然后用“MyComputer”通过“MyProxySite”在线代理网站，代理访问AVSite，返回AVSite站点信息，偶也～～～～</span></p> 
           <p>site = new MyProxySite(&quot;<a href="http://www.avsite.com/" target="_blank">http://www.avsite.com/</a>&quot;); // Use online web proxy.<br />myComputer.Visit(site);</p> 
           <p>结果：</p> 
           <p><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/pangxiaoliang/AVsiteProxy.jpg" width="298" height="84" /></p> 
           <p><span style="color: #339966">最后看完AV，我们再会博客园逛一逛</span></p> 
           <p><span>site = new CnblogsSite();<br />myComputer.Visit(site);</span></p> 
           <p><span>结果：</span></p> 
           <p><span><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/pangxiaoliang/CnBlogs.jpg" width="343" height="49" /></span></p> 
           <p><span></span>&nbsp;花了很大的功夫说代理，现在该切入正题了，我们的AOP，分为代理模式实现和Attribute实现。</p> 
           <p><span style="color: #339966">AOP框架实现</span></p> 
           <p>首先AOP实现了逻辑注入，即在调用方法之前进行了逻辑注入。我们使用System.Runtime.Remoting中呃Message机制来实现Message的截获和注入，有点像MFC框架中的钩子函数。</p> 
           <p>首先，为了实现逻辑注入，我们先要设计出逻辑注入的接口（IInterception）。为了简单起见逻辑注入我们只设计了3个Method，包括PreInvoke，PostInvoke和ExceptionHandle，分别用来注入“调用主题Method前的逻辑”，“调用主题Method后的逻辑”和“调用主题Method时发生Exception的逻辑”。具体实现如下：</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('b33f1b1e-695d-40f8-868c-a1b771d79714')">
            <img style="display: none" id="code_img_closed_b33f1b1e-695d-40f8-868c-a1b771d79714" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_b33f1b1e-695d-40f8-868c-a1b771d79714" class="code_img_opened" onclick="cnblogs_code_hide('b33f1b1e-695d-40f8-868c-a1b771d79714',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_b33f1b1e-695d-40f8-868c-a1b771d79714"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.AOP<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Description&nbsp;of&nbsp;IInterception.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">interface</span>
              <span style="color: #000000">&nbsp;IInterception<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Pre&nbsp;the&nbsp;method&nbsp;invoke.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;PreInvoke();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Post&nbsp;the&nbsp;method&nbsp;invoke.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;PostInvoke();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Handling&nbsp;the&nbsp;exception&nbsp;which&nbsp;occurs&nbsp;when&nbsp;the&nbsp;method&nbsp;is&nbsp;invoked.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;ExceptionHandle();<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>逻辑注入的接口（IInterception）永远不为null，根据Null Object模式设计了NullInterception（关于Null Object模式及其意义可以看我原来的文章），实现如下：</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('3c190a5a-d4de-45b0-a694-6fbd073e935d')">
            <img style="display: none" id="code_img_closed_3c190a5a-d4de-45b0-a694-6fbd073e935d" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_3c190a5a-d4de-45b0-a694-6fbd073e935d" class="code_img_opened" onclick="cnblogs_code_hide('3c190a5a-d4de-45b0-a694-6fbd073e935d',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_3c190a5a-d4de-45b0-a694-6fbd073e935d"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.AOP<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Null&nbsp;Object&nbsp;pattern&nbsp;for&nbsp;interception.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;NullInterception&nbsp;:&nbsp;IInterception<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#region</span>
              <span style="color: #000000">&nbsp;IInterception&nbsp;Members</span>
              <span style="color: #000000"><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Before&nbsp;invoke&nbsp;the&nbsp;real&nbsp;instance&nbsp;to&nbsp;do&nbsp;something.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">virtual</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;PreInvoke()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Do&nbsp;nothing.</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;End&nbsp;invoke&nbsp;the&nbsp;real&nbsp;instance&nbsp;to&nbsp;do&nbsp;something.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">virtual</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;PostInvoke()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Do&nbsp;nothing.</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Handling&nbsp;the&nbsp;exception&nbsp;which&nbsp;occurs&nbsp;when&nbsp;the&nbsp;method&nbsp;is&nbsp;invoked.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;ExceptionHandle()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Do&nbsp;nothing.</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#endregion</span>
              <span style="color: #000000"><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>为了实现Message拦截，我们必须实现一个继承了“RealProxy”的类“AOPRealProxy”，这样我们就可以重写System.Runtime.Remoting.Messaging.IMessage Invoke(System.Runtime.Remoting.Messaging.IMessage msg)方法来注入自己的逻辑。</p> 
           <p>有的时候代码能更清楚的表达，所以先将AOPRealProxy的实现附上：</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('6b5c7028-9e94-411f-8ecf-5968a8e17ef6')">
            <img style="display: none" id="code_img_closed_6b5c7028-9e94-411f-8ecf-5968a8e17ef6" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_6b5c7028-9e94-411f-8ecf-5968a8e17ef6" class="code_img_opened" onclick="cnblogs_code_hide('6b5c7028-9e94-411f-8ecf-5968a8e17ef6',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_6b5c7028-9e94-411f-8ecf-5968a8e17ef6"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Runtime.Remoting;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Runtime.Remoting.Proxies;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Runtime.Remoting.Messaging;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Runtime.Remoting.Services;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Runtime.Remoting.Activation;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.AOP<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;RealProxy&nbsp;is&nbsp;a&nbsp;abstract&nbsp;class,&nbsp;which&nbsp;is&nbsp;a&nbsp;class&nbsp;in&nbsp;Framework&nbsp;to&nbsp;provide&nbsp;the&nbsp;function&nbsp;about&nbsp;base&nbsp;proxy.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;Invoke&nbsp;method&nbsp;like&nbsp;the&nbsp;hook&nbsp;of&nbsp;MFC,&nbsp;it&nbsp;intercept&nbsp;the&nbsp;message,&nbsp;inject&nbsp;the&nbsp;custom&nbsp;logic&nbsp;and&nbsp;generate&nbsp;a&nbsp;new&nbsp;message<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;for&nbsp;system&nbsp;to&nbsp;performance.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;AOPRealProxy&nbsp;:&nbsp;RealProxy,&nbsp;IProxyDI<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">private</span>
              <span style="color: #000000">&nbsp;MarshalByRefObject&nbsp;_target&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">null</span>
              <span style="color: #000000">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">private</span>
              <span style="color: #000000">&nbsp;IInterception&nbsp;_interception&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">null</span>
              <span style="color: #000000">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;AOPRealProxy(Type&nbsp;targetType,&nbsp;MarshalByRefObject&nbsp;target)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;</span>
              <span style="color: #0000ff">base</span>
              <span style="color: #000000">(targetType)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_target&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;target;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_interception&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;NullInterception();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Overridden&nbsp;the&nbsp;method&nbsp;&quot;Invoke&quot;&nbsp;of&nbsp;the&nbsp;base&nbsp;class,&nbsp;invokes&nbsp;the&nbsp;method&nbsp;that&nbsp;is&nbsp;specified</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;&nbsp;in&nbsp;the&nbsp;provided&nbsp;System.Runtime.Remoting.Messaging.IMessage&nbsp;on&nbsp;the&nbsp;remote<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;&nbsp;object&nbsp;that&nbsp;is&nbsp;represented&nbsp;by&nbsp;the&nbsp;current&nbsp;instance.</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;param&nbsp;name=&quot;msg&quot;&gt;</span>
              <span style="color: #008000">A&nbsp;System.Runtime.Remoting.Messaging.IMessage&nbsp;that&nbsp;contains&nbsp;a&nbsp;System.Collections.IDictionary</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;&nbsp;of&nbsp;information&nbsp;about&nbsp;the&nbsp;method&nbsp;call.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;&nbsp;&lt;/param&gt;</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;returns&gt;</span>
              <span style="color: #008000">The&nbsp;message&nbsp;returned&nbsp;by&nbsp;the&nbsp;invoked&nbsp;method,&nbsp;containing&nbsp;the&nbsp;return&nbsp;value&nbsp;and</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;&nbsp;any&nbsp;out&nbsp;or&nbsp;ref&nbsp;parameters.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;&nbsp;&lt;/returns&gt;</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">override</span>
              <span style="color: #000000">&nbsp;System.Runtime.Remoting.Messaging.IMessage&nbsp;Invoke(System.Runtime.Remoting.Messaging.IMessage&nbsp;msg)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMethodReturnMessage&nbsp;methodReturnMessage&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">null</span>
              <span style="color: #000000">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMethodCallMessage&nbsp;methodCallMessage&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;msg&nbsp;</span>
              <span style="color: #0000ff">as</span>
              <span style="color: #000000">&nbsp;IMethodCallMessage;</span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">Check&nbsp;whether&nbsp;the&nbsp;message&nbsp;is&nbsp;method&nbsp;call&nbsp;message.</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">if</span>
              <span style="color: #000000">&nbsp;(methodCallMessage&nbsp;</span>
              <span style="color: #000000">!=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">null</span>
              <span style="color: #000000">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IConstructionCallMessage&nbsp;constructionCallMessage&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;methodCallMessage&nbsp;</span>
              <span style="color: #0000ff">as</span>
              <span style="color: #000000">&nbsp;IConstructionCallMessage;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">if</span>
              <span style="color: #000000">&nbsp;(constructionCallMessage&nbsp;</span>
              <span style="color: #000000">!=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">null</span>
              <span style="color: #000000">) </span>
              <span style="color: #339966">//Constructor Method.</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RealProxy&nbsp;defaultProxy&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;RemotingServices.GetRealProxy(_target);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defaultProxy.InitializeServerObject(constructionCallMessage);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;methodReturnMessage&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;EnterpriseServicesHelper.CreateConstructionReturnMessage(constructionCallMessage,&nbsp;(MarshalByRefObject)GetTransparentProxy()); </span>
              <span style="color: #339966">//Create the message about constructor.</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">else </span>
              <span style="color: #339966">//Other method except constructor method.</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_interception.PreInvoke(); </span>
              <span style="color: #339966">//Inject PreInvoke method.</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">try</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;methodReturnMessage&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;RemotingServices.ExecuteMessage(_target,&nbsp;methodCallMessage); </span>
              <span style="color: #339966">//Invoke subject method.</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">catch</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">if</span>
              <span style="color: #000000">&nbsp;(methodReturnMessage.Exception&nbsp;</span>
              <span style="color: #000000">!=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">null</span>
              <span style="color: #000000">)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_interception.ExceptionHandle(); </span>
              <span style="color: #339966">//Occur exception and then inject ExceptionHandle method.</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">else</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_interception.PostInvoke(); </span>
              <span style="color: #339966">//Inject PostInvoke method.</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">return</span>
              <span style="color: #000000">&nbsp;methodReturnMessage;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#region</span>
              <span style="color: #000000">&nbsp;IProxyDI&nbsp;Members</span>
              <span style="color: #000000"><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Dependency&nbsp;injection&nbsp;the&nbsp;interception&nbsp;into&nbsp;proxy&nbsp;class.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;param&nbsp;name=&quot;interception&quot;&gt;</span>
              <span style="color: #008000">The&nbsp;interception.</span>
              <span style="color: #808080">&lt;/param&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;InterceptionDI(IInterception&nbsp;interception)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_interception&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;interception; </span>
              <span style="color: #339966">//The pattern of interface inject,&nbsp;inject&nbsp;the interception.</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#endregion</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>使用接口注入方式，将Interception“拦截器”注入到“AOPRealProxy”类。</p> 
           <p>注入接口“IProxyDI”设计如下:</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('a6da2c05-e0ce-4f1d-beea-58c21be27adb')">
            <img style="display: none" id="code_img_closed_a6da2c05-e0ce-4f1d-beea-58c21be27adb" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_a6da2c05-e0ce-4f1d-beea-58c21be27adb" class="code_img_opened" onclick="cnblogs_code_hide('a6da2c05-e0ce-4f1d-beea-58c21be27adb',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_a6da2c05-e0ce-4f1d-beea-58c21be27adb"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.AOP<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">interface</span>
              <span style="color: #000000">&nbsp;IProxyDI<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;InterceptionDI(IInterception&nbsp;interception);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>&nbsp;1) 实现Proxy模式AOP：</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('f682b656-e876-464f-8250-5b399efc98f7')">
            <img style="display: none" id="code_img_closed_f682b656-e876-464f-8250-5b399efc98f7" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_f682b656-e876-464f-8250-5b399efc98f7" class="code_img_opened" onclick="cnblogs_code_hide('f682b656-e876-464f-8250-5b399efc98f7',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_f682b656-e876-464f-8250-5b399efc98f7"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Collections.Generic;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Text;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.AOP<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;ProxyFactory<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">static</span>
              <span style="color: #000000">&nbsp;T&nbsp;CreateProxyInstance</span>
              <span style="color: #000000">&lt;</span>
              <span style="color: #000000">T</span>
              <span style="color: #000000">&gt;</span>
              <span style="color: #000000">(IInterception&nbsp;interception)&nbsp;</span>
              <span style="color: #0000ff">where</span>
              <span style="color: #000000">&nbsp;T&nbsp;:&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Type&nbsp;serverType&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">typeof</span>
              <span style="color: #000000">(T);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MarshalByRefObject&nbsp;target&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;Activator.CreateInstance(serverType)&nbsp;</span>
              <span style="color: #0000ff">as</span>
              <span style="color: #000000">&nbsp;MarshalByRefObject;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AOPRealProxy&nbsp;aopRealProxy&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;AOPRealProxy(serverType,&nbsp;target);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aopRealProxy.InterceptionDI(interception);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">return</span>
              <span style="color: #000000">&nbsp;(T)aopRealProxy.GetTransparentProxy();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>实现了interception参数注入AOPRealProxy，将包装完成的传输代理类返回。此时返回的代理类对象操作起来如同直接操作“主题”。</p> 
           <p>2）实现Attribute模式AOP</p> 
           <p>&nbsp;</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('3245f8e6-6862-4fdf-a91e-17bb3fe0ba79')">
            <img style="display: none" id="code_img_closed_3245f8e6-6862-4fdf-a91e-17bb3fe0ba79" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_3245f8e6-6862-4fdf-a91e-17bb3fe0ba79" class="code_img_opened" onclick="cnblogs_code_hide('3245f8e6-6862-4fdf-a91e-17bb3fe0ba79',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_3245f8e6-6862-4fdf-a91e-17bb3fe0ba79"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Authors:<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Xiaoliang&nbsp;Pang&nbsp;(mailto:mv@live.cn)<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;Copyright&nbsp;(c)&nbsp;2010&nbsp;Landpy&nbsp;Software<br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #008000; text-decoration: underline">http://www.cnblogs.com/pangxiaoliang</span>
              <span style="color: #008000"><br /></span>
              <span style="color: #008000">//<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System;<br /></span>
              <span style="color: #0000ff">using</span>
              <span style="color: #000000">&nbsp;System.Runtime.Remoting.Proxies;<br /><br /></span>
              <span style="color: #0000ff">namespace</span>
              <span style="color: #000000">&nbsp;Landpy.AOP<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Description&nbsp;of&nbsp;AOPProxyAttribute.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;[AttributeUsage(AttributeTargets.Class)]<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;AOPProxyAttribute&nbsp;:&nbsp;ProxyAttribute<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">private</span>
              <span style="color: #000000">&nbsp;IInterception&nbsp;_interception;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;Type&nbsp;Interception<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">get</span>
              <span style="color: #000000">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">return</span>
              <span style="color: #000000">&nbsp;_interception.GetType();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">set</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IInterception&nbsp;interception&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;Activator.CreateInstance(value)&nbsp;</span>
              <span style="color: #0000ff">as</span>
              <span style="color: #000000">&nbsp;IInterception;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_interception&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;interception;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;AOPProxyAttribute()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_interception&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;NullInterception();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">override</span>
              <span style="color: #000000">&nbsp;MarshalByRefObject&nbsp;CreateInstance(Type&nbsp;serverType)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MarshalByRefObject&nbsp;target&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">base</span>
              <span style="color: #000000">.CreateInstance(serverType);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AOPRealProxy&nbsp;aopRealProxy&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;AOPRealProxy(serverType,&nbsp;target);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aopRealProxy.InterceptionDI(_interception);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">return</span>
              <span style="color: #000000">&nbsp;aopRealProxy.GetTransparentProxy()&nbsp;</span>
              <span style="color: #0000ff">as</span>
              <span style="color: #000000">&nbsp;MarshalByRefObject;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>实现了interception的Attribute用type注入AOPRealProxy，将包装完成的传输代理类返回。此时返回的代理类对象操作起来如同直接操作“主题”。</p> 
           <p><span style="color: #339966">测试AOP框架</span></p> 
           <p><span style="color: red">（一）测试代理模式AOP。</span></p> 
           <p>// Proxy class to implement the AOP.<br />IInterception interception = new MyInterception();<br />AOPTestWithProxyClass aopTestTwo = ProxyFactory.CreateProxyInstance&lt;AOPTestWithProxyClass&gt;(interception) as AOPTestWithProxyClass;<br />aopTestTwo.Show();</p> 
           <p>首先实例化了一个MyInterception的拦截器，然后用ProxyFactory将Interception作为传入注入“主题”。</p> 
           <p>MyInterception实现如下：</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('86897bcf-3506-40b9-8498-64998a4f2e23')">
            <img style="display: none" id="code_img_closed_86897bcf-3506-40b9-8498-64998a4f2e23" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_86897bcf-3506-40b9-8498-64998a4f2e23" class="code_img_opened" onclick="cnblogs_code_hide('86897bcf-3506-40b9-8498-64998a4f2e23',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_86897bcf-3506-40b9-8498-64998a4f2e23"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;interception&nbsp;of&nbsp;the&nbsp;AOP.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;MyInterception&nbsp;:&nbsp;IInterception<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#region</span>
              <span style="color: #000000">&nbsp;IInterception&nbsp;Members</span>
              <span style="color: #000000"><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Before&nbsp;invoke&nbsp;the&nbsp;real&nbsp;instance&nbsp;to&nbsp;do&nbsp;something.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;PreInvoke()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Green;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">===Pre&nbsp;MyInterception.===</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Gray;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;End&nbsp;invoke&nbsp;the&nbsp;real&nbsp;instance&nbsp;to&nbsp;do&nbsp;something.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;PostInvoke()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Green;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">===Post&nbsp;MyInterception.===</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Gray;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;Handling&nbsp;the&nbsp;exception&nbsp;which&nbsp;occurs&nbsp;when&nbsp;the&nbsp;method&nbsp;is&nbsp;invoked.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;ExceptionHandle()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Red;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">There&nbsp;is&nbsp;a&nbsp;exception!</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Gray;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#endregion</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;}</span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>AOPTestWithProxyClass实现如下：</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('8496e9fa-457f-4570-a4f0-2131a23c14f2')">
            <img style="display: none" id="code_img_closed_8496e9fa-457f-4570-a4f0-2131a23c14f2" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_8496e9fa-457f-4570-a4f0-2131a23c14f2" class="code_img_opened" onclick="cnblogs_code_hide('8496e9fa-457f-4570-a4f0-2131a23c14f2',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_8496e9fa-457f-4570-a4f0-2131a23c14f2"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;test&nbsp;class&nbsp;for&nbsp;AOP&nbsp;use&nbsp;proxy&nbsp;class.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000; ">&nbsp;AOPTestWithProxyClass&nbsp;:&nbsp;ContextBoundObject<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;Show()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Gray;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">Hello,&nbsp;I&nbsp;am&nbsp;AOPTestTwo.</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Gray;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}</span>
             </div>
            </div>
           </div> 
           <p>结果：</p> 
           <p><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/pangxiaoliang/ProxyAOP.jpg" width="272" height="56" /></p> 
           <p>可见<span style="color: #800000">&quot;</span><span style="color: #800000">===Pre&nbsp;MyInterception.===&quot;和&quot;<span style="color: #800000">===Post&nbsp;MyInterception.===</span>&quot;已经成功实现AOP注入。</span></p> 
           <p><span style="color: red">（二）测试Attribute实现AOP。</span></p> 
           <p>// Attribute to implement the AOP.<br />AOPTestWithAttribute aopTest = new AOPTestWithAttribute();<br />aopTest.Show();</p> 
           <p>此时的代码要比Proxy实现更为简单，直接用类的构造函数实现类的实例化，不用ProxyFactory生成实例，Interception同样还是使用了MyInterception。</p> 
           <p>AOPTestWithAttribute类的实现如下：</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('191ef5d5-b120-4fe8-afe2-8c021080a16c')">
            <img style="display: none" id="code_img_closed_191ef5d5-b120-4fe8-afe2-8c021080a16c" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_191ef5d5-b120-4fe8-afe2-8c021080a16c" class="code_img_opened" onclick="cnblogs_code_hide('191ef5d5-b120-4fe8-afe2-8c021080a16c',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_191ef5d5-b120-4fe8-afe2-8c021080a16c"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;test&nbsp;class&nbsp;for&nbsp;AOP&nbsp;use&nbsp;attribute..<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;[AOPProxy(Interception&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">typeof</span>
              <span style="color: #000000">(MyInterception))]<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;AOPTestWithAttribute&nbsp;:&nbsp;ContextBoundObject<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;Show()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Gray;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">Hello,&nbsp;I&nbsp;am&nbsp;AOPTest.</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Gray;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}</span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>结果：</p> 
           <p><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/pangxiaoliang/AttributeAOP.jpg" width="231" height="51" /></p> 
           <p><span style="color: red">（三）测试Attribute实现AOP[事务的提交和回滚]。</span></p> 
           <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; AOPTestWithAttributForTrasaction aopTestWithAttributForTrasaction = new AOPTestWithAttributForTrasaction();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Execute the transaction successfully.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aopTestWithAttributForTrasaction.ExecuteTransactionSuccessfully();</p> 
           <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WriteSplitLine();</p> 
           <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Execute the transaction unsuccessfully.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aopTestWithAttributForTrasaction.ExecuteTransactionUnsuccessfully();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch (Exception ex)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.ForegroundColor = ConsoleColor.Blue;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.WriteLine(ex.Message);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.ForegroundColor = ConsoleColor.Gray;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p> 
           <p>在ExecuteTransactionUnsuccessfully方法中加入throw Excetpion代码，实现执行不成功的情况。当执行ExecuteTransactionSuccessfully方法时实现事务的提交，当执行ExecuteTransactionUnsuccessfully实现事务的回滚，此时的例子可以对照前面所将的Castle ActiveRecord的事务实现AOP的例子。</p> 
           <p>AOPTestWithAttributForTrasaction实现如下：</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('1cb089fb-a14f-42d8-9c08-58fe9fc4e041')">
            <img style="display: none" id="code_img_closed_1cb089fb-a14f-42d8-9c08-58fe9fc4e041" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_1cb089fb-a14f-42d8-9c08-58fe9fc4e041" class="code_img_opened" onclick="cnblogs_code_hide('1cb089fb-a14f-42d8-9c08-58fe9fc4e041',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_1cb089fb-a14f-42d8-9c08-58fe9fc4e041"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;[AOPProxy(Interception&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">typeof</span>
              <span style="color: #000000">(TransactionInterception))]<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;AOPTestWithAttributForTrasaction&nbsp;:&nbsp;ContextBoundObject<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;ExecuteTransactionSuccessfully()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">Execute&nbsp;the&nbsp;transaction&nbsp;successfully:)</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;ExecuteTransactionUnsuccessfully()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">Execute&nbsp;the&nbsp;transaction&nbsp;unsuccessfully:(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">throw</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">new</span>
              <span style="color: #000000">&nbsp;AOPNullException();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}</span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>Interception使用了新的TransactionInterception，TransactionInterception的实现如下：</p> 
           <div class="cnblogs_code" onclick="cnblogs_code_show('60ba34d3-1f0e-4e8e-9044-70de22d5016d')">
            <img style="display: none" id="code_img_closed_60ba34d3-1f0e-4e8e-9044-70de22d5016d" class="code_img_closed" alt="" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" />
            <img id="code_img_opened_60ba34d3-1f0e-4e8e-9044-70de22d5016d" class="code_img_opened" onclick="cnblogs_code_hide('60ba34d3-1f0e-4e8e-9044-70de22d5016d',event)" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" />
            <span class="cnblogs_code_collapse">代码</span> 
            <div id="cnblogs_code_open_60ba34d3-1f0e-4e8e-9044-70de22d5016d"> 
             <div>
              <!--<br/ /><br/ />Code highlighting produced by Actipro CodeHighlighter (freeware)<br/ />http://www.CodeHighlighter.com/<br/ /><br/ />-->
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;summary&gt;</span>
              <span style="color: #008000"><br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;The&nbsp;interception&nbsp;of&nbsp;the&nbsp;AOP&nbsp;for&nbsp;trasaction.<br />&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #808080">///</span>
              <span style="color: #008000">&nbsp;</span>
              <span style="color: #808080">&lt;/summary&gt;</span>
              <span style="color: #808080"><br /></span>
              <span style="color: #000000">&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">class</span>
              <span style="color: #000000">&nbsp;TransactionInterception&nbsp;:&nbsp;IInterception<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#region</span>
              <span style="color: #000000">&nbsp;IInterception&nbsp;Members</span>
              <span style="color: #000000"><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;ExceptionHandle()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Red;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">☆☆☆Rollback&nbsp;transaction☆☆☆</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Gray;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;PostInvoke()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Green;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">☆☆☆Commit&nbsp;transaction☆☆☆</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Gray;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">public</span>
              <span style="color: #000000">&nbsp;</span>
              <span style="color: #0000ff">void</span>
              <span style="color: #000000">&nbsp;PreInvoke()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Green;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #800000">☆☆☆Begin&nbsp;transaction☆☆☆</span>
              <span style="color: #800000">&quot;</span>
              <span style="color: #000000">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.ForegroundColor&nbsp;</span>
              <span style="color: #000000">=</span>
              <span style="color: #000000">&nbsp;ConsoleColor.Gray;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              <span style="color: #0000ff">#endregion</span>
              <span style="color: #000000"><br />&nbsp;&nbsp;&nbsp;&nbsp;}</span>
             </div>
            </div>
           </div> 
           <p>&nbsp;</p> 
           <p>结果：</p> 
           <p><img border="0" alt="" src="http://images.cnblogs.com/cnblogs_com/pangxiaoliang/Transaction.jpg" width="565" height="131" /></p> 
           <p>&nbsp;注意：在Debug下执行到“throw new AOPNullException();”时会停止，继续F5即可执行，如果非Debug状态（如直接双击exe执行），则可以执行到结束。</p> 
           <p>&nbsp;这是由Debug机制造成的，不必在意。</p>
           <p>&nbsp;本人实现的AOP框架是基于<span class="Apple-style-span" style="font-family: 'Courier New'; font-size: 13px; ">ContextBoundObject，</span><span class="Apple-style-span" style="font-family: 'Courier New'; font-size: 13px; ">MarshalByRefObject</span><span class="Apple-style-span" style="font-family: 'Courier New'; font-size: 13px; ">的，在效率上会差一些，当然我们可以用反射的高级内容Emit直接生成IL注入原始程序逻辑来实现AOP，有空写篇文章介绍下:)</span></p> 
           <p> </p>
           <hr /> 
           <p>&nbsp;</p> 
           <p><span style="color: #ff0000"><a href="http://files.cnblogs.com/pangxiaoliang/ArchitectTestForAOP.zip" target="_blank"><span style="color: #ff0000">&lt;&lt;完整Demo下载&gt;&gt;</span></a></span></p> 
           <p>&nbsp;</p>
          </div>
          <div id="MySignature"></div> 
          <div class="clear"></div> 
          <div id="blog_post_info_block"> 
           <div id="BlogPostCategory"></div> 
           <div id="EntryTag"></div> 
           <div id="blog_post_info"> 
           </div> 
           <div class="clear"></div> 
           <div id="post_next_prev"></div> 
          </div> 
         </div> 
         <div class="postDesc">
          posted @ 
          <span id="post-date">2010-03-09 16:26</span> 
          <a href="http://www.cnblogs.com/pangxiaoliang/">pangxiaoliang[北京]流浪者</a> 阅读(
          <span id="post_view_count">...</span>) 评论(
          <span id="post_comment_count">...</span>) 
          <a href="https://i.cnblogs.com/EditPosts.aspx?postid=1680673" rel="nofollow">编辑</a> 
          <a href="#" onclick="AddToWz(1680673);return false;">收藏</a>
         </div> 
        </div> 
        <script type="text/javascript">var allowComments=true,cb_blogId=39034,cb_entryId=1680673,cb_blogApp=currentBlogApp,cb_blogUserGuid='df41420b-63cf-dd11-9e4d-001cf0cd104b',cb_entryCreatedDate='2010/3/9 16:26:00';loadViewCount(cb_entryId);</script> 
       </div>
       <!--end: topics 文章、评论容器--> 
      </div>
      <a name="!comments"></a>
      <div id="blog-comments-placeholder"></div>
      <script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script> 
      <div id="comment_form" class="commentform"> 
       <a name="commentform"></a> 
       <div id="divCommentShow"></div> 
       <div id="comment_nav">
        <span id="span_refresh_tips"></span>
        <a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a>
        <a href="#" onclick="return RefreshPage();">刷新页面</a>
        <a href="#top">返回顶部</a>
       </div> 
       <div id="comment_form_container"></div> 
       <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div> 
       <div id="ad_t2"></div> 
       <div id="opt_under_post"></div> 
       <div id="ad_c1" class="c_ad_block"></div> 
       <div id="under_post_news"></div> 
       <div id="ad_c2" class="c_ad_block"></div> 
       <div id="under_post_kb"></div> 
       <div id="HistoryToday" class="c_ad_block"></div> 
       <script type="text/javascript">
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</script> 
      </div> 
     </div>
     <!--end: forFlow --> 
    </div>
    <!--end: mainContent 主体内容容器--> 
    <div id="sideBar"> 
     <div id="sideBarMain"> 
      <!--done--> 
      <div class="newsItem"> 
       <h3 class="catListTitle">公告</h3> 
       <div id="blog-news"></div>
       <script type="text/javascript">loadBlogNews();</script> 
      </div> 
      <div id="calendar">
       <div id="blog-calendar" style="display:none"></div>
       <script type="text/javascript">loadBlogDefaultCalendar();</script>
      </div> 
      <div id="leftcontentcontainer"> 
       <div id="blog-sidecolumn"></div>
       <script type="text/javascript">loadBlogSideColumn();</script> 
      </div> 
     </div>
     <!--end: sideBarMain --> 
    </div>
    <!--end: sideBar 侧边栏容器 --> 
    <div class="clear"></div> 
   </div>
   <!--end: main --> 
   <div class="clear"></div> 
   <div id="footer"> 
    <!--done--> Copyright &copy;2017 pangxiaoliang[北京]流浪者 
   </div>
   <!--end: footer --> 
  </div>
  <!--end: home 自定义的最大容器 --> 
  <!--PageEndHtml Block Begin--> 
  <div style="text-align: right">
    小豆芽之父 
  </div> 
  <!--PageEndHtml Block End-->   
 </body>
</html>