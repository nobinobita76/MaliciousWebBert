<!DOCTYPE html>
<html>
 <head> 
  <meta charset="utf-8" /> 
  <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" /> 
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0" /> 
  <title id="title">webrtc这个坑</title> 
  <meta name="keywords" content="webrtc这个坑" /> 
  <meta name="description" content=" 像这种成熟开源项目没有必要百度google，直接去官网就行了，官网上的资料都很详细。当然需要翻墙。我用的是expressvpn，这是一个外国的vpn，还比较靠谱。我之前用的是国内的cocovpn，这个vpn在一个多月前用不了了。不知是封了还是老板跑路了。



 由于当前用的回声抑制库的CPU使用率过高，于是开始研究webrtc。运行了WebRTCDemo，看了一看单纯音频处理这一块的C" /> 
  <link rel="canonical" href="http://m.fx114.net/qa-74-162279.aspx" /> 
  <link type="text/css" rel="stylesheet" href="css/2014/m/style131017.css" /> 
  <link href="css/2014/m/media_queries.css" rel="stylesheet" type="text/css" /> 
  <!--[if lt IE 9]>
	<script src="/js/2014/m/html5shiv.js"></script>
<![endif]--> 
  <!--[if lt IE 9]> 
	<script src="/js/2014/m/css3-mediaqueries.js"></script>  
<![endif]--> 
  <script type="text/javascript" src="js/2014/m/jquery-1.5.min.js"></script> 
  <script type="text/javascript" src="js/2014/m/list.js"></script> 
  <script type="text/javascript" src="js/2014/m/click_more.js"></script> 
  <script type="text/javascript" src="js/2014/m/top.js"></script> 
  <script type="text/javascript">
<!--
    function getOs() {
        var OsObject = "";
        //IE
        if (navigator.userAgent.indexOf("MSIE") > 0) { return -1; }
        //火狐
        if (isFirefox = navigator.userAgent.indexOf("Firefox") > 0) { return -1; }
        //360极速
        if (isSafari = navigator.userAgent.indexOf("Safari") > 0) { return -2; }
        //谷歌
        if (isCamino = navigator.userAgent.indexOf("Camino") > 0) { return -2; }
        //火狐
        if (isMozilla = navigator.userAgent.indexOf("Gecko/") > 0) { return -1; }
    } 
--> 
</script> 
 </head> 
 <body> 
  <script type="text/javascript">
    /*创建于 2017/3/21 mb*/
    var cpro_id = "u2931063";
</script> 
  <script type="text/javascript" src="http://cpro.baidustatic.com/cpro/ui/cm.js"></script> 
  <header> 
   <div class="loc_logo_nav"> 
    <div class="loc_logo_navbtn"> 
     <div class="loc_logo"> 
      <div class="loc">
       <a href="#" onclick="javascript:history.go(getOs());"><img src="images/2014/m/back_icon_50x50.jpg" alt="分享查询网" /></a>
      </div> 
      <div class="logo"> 
       <h1><span id="spanNav"><a href="List-2-74-1.aspx" title="应用服务器">应用服务器</a></span></h1> 
      </div> 
     </div> 
     <div class="navbtn" id="navbtn"></div> 
    </div> 
    <nav> 
     <ul> 
      <li><a href="List-2-67-1.aspx" title="HTML(CSS)">HTML(CSS)</a></li> 
      <li><a href="List-2-68-1.aspx" title="ASP">ASP</a></li> 
      <li><a href="List-2-69-1.aspx" title="跨浏览器开发">跨浏览器开发</a></li> 
      <li><a href="List-2-70-1.aspx" title="IIS">IIS</a></li> 
      <li><a href="List-2-71-1.aspx" title="Apache">Apache</a></li> 
      <li><a href="List-2-72-1.aspx" title="vbScript">vbScript</a></li> 
      <li><a href="List-2-73-1.aspx" title="JavaScript">JavaScript</a></li> 
      <li><a href="List-2-74-1.aspx" title="应用服务器">应用服务器</a></li> 
      <li><a href="List-2-75-1.aspx" title="XML/XSL">XML/XSL</a></li> 
      <li><a href="List-2-76-1.aspx" title="其他">其他</a></li> 
      <li><a href="List-2-77-1.aspx" title="CGI">CGI</a></li> 
      <li><a href="List-2-78-1.aspx" title="Ajax">Ajax</a></li> 
      <li><a href="List-2-79-1.aspx" title="非技术区">非技术区</a></li> 
      <li><a href="List-2-80-1.aspx" title="ColdFusion">ColdFusion</a></li> 
      <li><a href="List-2-81-1.aspx" title="Ruby/Rails">Ruby/Rails</a></li> 
      <li><a href="List-2-82-1.aspx" title="HTML5">HTML5</a></li> 
      <div class="clear"></div> 
     </ul> 
    </nav> 
   </div> 
   <div class="clear"> 
   </div> 
  </header> 
  <article> 
   <h2 id="h2Value">webrtc这个坑</h2> 
   <div class="time_source"> 
    <span id="spanAddTime">发布时间：2016-10-2 23:32:51</span>
    <br />来源：分享查询网 
   </div> 
   <div class="content"> 
    <p id="pContent"></p>
    <div id="article_content" class="article_content">
     <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 像这种成熟开源项目没有必要百度google，直接去官网就行了，官网上的资料都很详细。当然需要翻墙。我用的是expressvpn，这是一个外国的vpn，还比较靠谱。我之前用的是国内的cocovpn，这个vpn在一个多月前用不了了。不知是封了还是老板跑路了。<br /> </p> 
     <p><br /> </p> 
     <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 由于当前用的回声抑制库的CPU使用率过高，于是开始研究webrtc。运行了WebRTCDemo，看了一看单纯音频处理这一块的CPU使用率并不高。webrtc也是google的开源项目，下载代码的方式和Crosswalk应该是一样的。在Android源码中和Crosswalk中都有webrtc的源码，理论上在他们的代码中也能够编译webrtc，我在crosswalk中运行了webrtc中生成gyp的脚本gyp_webrtc提示依赖chromium,我觉得这是个坑，还是下载源码吧。wenrtc用到chromium中的基础库和编译工具，所以也要下载chromium。这个项目下载下来22G，大大出乎我的意料，因为单纯的webrtc代码才100多M。</p> 
     <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 接下来开始编译了，还是出现了新的坑。python webrtc/build/gyp_webrtc，提示一个java文件找不到，我在webrtc issue上搜到这个问题，这个问题的状态是Fixed，表明已经解决了。我下载的代码已经是最新的，我看看了针对这个问题改动的文件和我下载下来的也一样，理论上不应该出现这个问题。错误是某个模块依赖的文件找不到，正好这个文件在test目录中，我想应该无关紧要，打开chromium/src/base/base.gyp，搜索这个文件，发现它属于junit_test这个模块，junit是一个自动测试的框架。注释掉应该无关紧要。注释掉之后这个错误过去了，但是出现新的错误，pkg-config找不到gobject gtk等。编译Android版的肯定不需要gtk<code><span style="color:#0600">。首先想到是不是下错了，但是已经gclient <span style="color:#0600"> config过了，<span style="color:#0600">.gclient 也是A<span style="color:#0600">ndroid<span style="color:#0600">。文件应该没有下载错误。<span style="font-size:1em; line-height:1.5; background-color:transparent"><font face="monospace" color="#0600" style="font-size:13.3333330154419px"><code>代码仓库在master，这是开发中的版本，应该不问题。<font color="#0600">应该在稳定版本上编译<span style="color:#0600">，果然官网上提到了如何在分支上工作，我选择在branch-heads/43,<span style="color:#0600">这是一个靠中间的版本。<span style="color:#0600">切换完分支后再次运行</span></span></span></font>python webrtc/build/gyp_webrtc，还是原来的错误。想到GYP_DEFINES是<span style="color:#0600">以环境变量的形式存在，<span style="color:#0600">除了config时用到，其他的命令也许同样会用到，于是</span></span></code></font></span></span></span></span></span></span></code><span style="font-size:1em; line-height:1.5; background-color:transparent"><span style="font-family:monospace; color:#0600; font-size:13.3333330154419px"><code>export GYP_DEFINES=&quot;OS=android&quot;</code></span></span>。再执行python webrtc/build/gyp_webrtc通过。</p> 
     <p>编译后又出现下面这个错误：</p> 
     <p>-compile:<br /> &nbsp;&nbsp;&nbsp; [javac] Compiling 4 source files to /mnt/sda/project/android_webrtc/src/webrtc/examples/android/opensl_loopback/bin/classes<br /> &nbsp;&nbsp;&nbsp; [javac] warning: [options] source value 1.5 is obsolete and will be removed in a future release<br /> &nbsp;&nbsp;&nbsp; [javac] warning: [options] target value 1.5 is obsolete and will be removed in a future release<br /> &nbsp;&nbsp;&nbsp; [javac] warning: [options] To suppress warnings about obsolete options, use -Xlint:-options.<br /> &nbsp;&nbsp;&nbsp; [javac] error: warnings found and -Werror specified<br /> &nbsp;&nbsp;&nbsp; [javac] 1 error<br /> &nbsp;&nbsp;&nbsp; [javac] 3 warnings<br /> <br /> BUILD FAILED<br /> /mnt/sda/project/android_webrtc/src/third_party/android_tools/sdk/tools/ant/build.xml:720: The following error occurred while executing this line:<br /> /mnt/sda/project/android_webrtc/src/third_party/android_tools/sdk/tools/ant/build.xml:734: Compile failed; see the compiler error output for details.<br /> 我想是不是和jdk的版本有关，系统中用的是jdk1.6和jdk1.8，官网上用的是1.7。我从jdk1.6换到jdk1.8，虽然不是1.7感觉应该和这无关。</p> 
     <p>opensl_loopback编译不过也许我要的WebRTCDemo能够编译过。ninja -C out/Release WebRTCDemo，编译过了。</p> 
     <p><br /> </p> 
     <p>成功！</p> 
     <p><br /> </p> 
     <p>后续问题</p> 
     <p>我将media_demo导入进eclipse，失败了。对比了一下其他的工程发现少了.project文件和.settings文件夹，补上之后仍然不行。折腾了一阵终于好了，两个原因：</p> 
     <p>1、代码目录不能拷贝到workspace目录下面。</p> 
     <p>2、一个workspace下面不能有两个相同名称的工程。<br /> </p> 
     <p><br /> </p> 
    </div>
    <p></p> 
   </div> 
  </article> 
  <div id="top"> 
   <img src="images/2014/m/top_icon_31x11.png" id="goTopBtn" title="返回顶部" alt="返回顶部" /> 
  </div> 
  <div class="computer"> 
   <a href="http://www.fx114.net/qa-74-162279.aspx" target="_blank">查看电脑版</a> 
  </div> 
  <footer> 
   <p class="fontArial">Copyright &copy;2017 <a href="http://m.fx114.net/" title="分享查询网">分享查询网</a> All rights reserved.</p> 
  </footer> 
  <div style="display:none;"> 
   <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?b41e21aaf49ad2eda6b7f39b8d1dd98e";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
</script> 
  </div>  
 </body>
</html>