<!DOCTYPE html><html lang="en" style="font-size: 0px; "><head>
    <meta charset="UTF-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>有妖气-漫画阅读</title>
    <script>
        //设置rem所需的html字号大小
        var docEl = document.documentElement,
                resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                recalc = function () {
                    document.getElementsByTagName("html")[0].style.fontSize = docEl.clientWidth / 10 + "px";
                };
        window.addEventListener(resizeEvt, recalc, false);
        document.addEventListener('DOMContentLoaded', recalc, false);
    </script>
    <link rel="stylesheet" href="http://k.static.u17i.com/m/mobile2017/css/common.css">
    <link rel="stylesheet" href="http://k.static.u17i.com/m/mobile2017/css/read.css">
</head>
<body class="read">
<header id="header">
        <a href="/c/124707.html" class="chapter_back"></a>
        <span class="cur-page">腐女教育</span>
            <span class="collect-btn collect"></span>
        
</header>

<div id="comicWeb">
    
    <div id="scroller">
        <!-- 如果不希望li下面有黑色边框，给ul添加class：noBorder -->
                <a href="/r/570532.html" class="last-chapter" style="display: block">点击进入上一章节</a>
                        <ul class="pic-list chapterid570534">
                                            <li class="chapter-section loadingPic" chapternum="295" imageid="4236340" chapterid="570533" chapterinfo="谨以此话献给亲爱的红绿党" picnum="0" total="1" data-width="720" data-height="2915">
                    <img src="http://img7.cdn.u17i.com/16/12/124707/wp/14335889_1483009180_4AZ244AqGh6h.663d1_50.jpg" is_read="" imageurl="http://img7.cdn.u17i.com/16/12/124707/wp/14335889_1483009180_4AZ244AqGh6h.663d1_50.jpg" class="images" style="height: 0px; width: 0px; " data-timeout="">
                </li>
                
                <!-- 阅读结束页 -->
                <li class="noBorder">
                    <!-- 章节末尾 -->
                                                            <img src="http://k.static.u17i.com/m/mobile2017/images/read_bottom.jpg" alt="" class="installApp">
                                        <a data-href="JavaScript:void(0)" class="next-chapter" style="display: none; ">点击进入下一章节</a>
                                    </li>
                <!-- 阅读结束页 end -->
            </ul>

    <ul class="pic-list chapterid570535"><li class="chapter-section loadShow" chapternum="296" chapterinfo="腐女教育" picnum="0" total="1" imageid="4236341" chapterid="570534" data-width="720" data-height="2914"><img imageurl="http://img7.cdn.u17i.com/16/12/124707/wp/14335889_1483009302_ezy8Yj2Fn8Ju.dd8e1_50.jpg" src="http://img7.cdn.u17i.com/16/12/124707/wp/14335889_1483009302_ezy8Yj2Fn8Ju.dd8e1_50.jpg" alt="" class="images" style="width: 0px; height: 0px; "></li><li class="noBorder"><img src="http://k.static.u17i.com/m/mobile2017/images/read_bottom.jpg" alt="" class="installApp"><a href="javascript:" class="next-chapter" id="570535" style="display: none">点击进入下一章节</a></li></ul></div>
        <!-- 提示付费 添加class:show ，来显示该对话框 -->
        <!-- 提示付费 end -->

    <!-- 提示vip充值添加class:show ，来显示该对话框 -->
        <!-- 提示VIP充值 end -->

    <!-- 返回顶部 -->
    <!-- <span class="back-top"></span> -->
    <!-- 返回顶部 end -->
</div>
<div id="read-menu">
    <!-- 目录链接 -->
    <a href="/wap/comicChapter/getChapters?comic_id=124707" class="catalog-btn"></a>
    <!-- 目录链接 end -->
    <!-- 下载1 -->
    <span class="download1-btn"></span>
    <!-- 下载1 end -->
    <!-- 下载2 -->
    <span class="download2-btn"></span>
    <!-- 下载2 end -->
</div>
<!-- 显示当前页码 -->
<div class="show-page need show"><span>295</span>话:<span class="page-num">1/1</span></div>
<!-- 显示当前页码 end -->
<!-- 看的不爽？添加class：show，显示弹窗 -->
<div class="dialog-content download1">
    <div class="dialog-box">
        <div class="dialog-title">
            看的不爽？
            <span class="dialog-close"></span>
        </div>
        <div class="dialog-info">
            <div class="dialog-str">
                想要：<br>
                更加流畅的阅读享受！<br>
                海量无码超清大图~<br>
                爽到爆的神秘黑科技？
            </div>
            <span class="dialog-btn install">点这里，啥都有！</span>
        </div>
    </div>
</div>
<!-- 看的不爽？ end -->
<!-- 有妖气，什么都能下！ 添加class：show，显示弹窗 -->
<div class="dialog-content download2">
    <div class="dialog-box">
        <div class="dialog-title">
            有妖气，什么都能下！
            <span class="dialog-close"></span>
        </div>
        <div class="dialog-info">
            <div class="dialog-str2">
                极速缓存，离线阅读<br>
                本地调戏尽在有妖气漫画APP!
            </div>
            <span class="dialog-btn install">我不信！</span>
        </div>
    </div>
</div>
<div class="share-content">
    <div class="share-box shareBox2">
        <div class="share-title">分享</div>
        <span class="share-section" id="qq">
            <img src="http://k.static.u17i.com/m/mobile2017/images/icon_qzone.png">
            QQ空间
        </span>
        <span data-href="#" class="share-section" id="friend">
            <img src="http://k.static.u17i.com/m/mobile2017/images/coagent_qq.png">
            QQ好友
        </span>
        <span data-href="#" class="share-section" id="weibo">
            <img src="http://k.static.u17i.com/m/mobile2017/images/coagent_weibo.png">
            微博
        </span>
        <span class="share-close">取消分享</span>
    </div>
</div>
<script src="http://k.static.u17i.com/m/mobile2017/js/base64.js"></script>
<!-- 有妖气，什么都能下！ end -->
<script src="http://k.static.u17i.com/m/mobile2017/js/zepto.min.js"></script>
<script src="http://k.static.u17i.com/m/mobile2017/js/iscroll-probe.js"></script>
<script src="http://k.static.u17i.com/m/mobile2017/js/touch.js"></script>
<script src="http://k.static.u17i.com/m/mobile2017/js/basic.js"></script>
<!--<script src="http://k.static.u17i.com/m/mobile2017/js/read.js"></script>-->


<div style="display:none">
<!-- js的m站全站统计 -->
<script src="http://w.cnzz.com/c.php?id=1253281198&amp;l=3" language="JavaScript"></script><script src="http://c.cnzz.com/core.php?web_id=1253281198&amp;l=3&amp;t=q" charset="utf-8" type="text/javascript"></script><a href="http://quanjing.cnzz.com" target="_blank" title="全景统计">全景统计</a>
<script src="http://w.cnzz.com/c.php?id=30088157&amp;l=3" language="JavaScript"></script><script src="http://c.cnzz.com/core.php?web_id=30088157&amp;l=3&amp;t=q" charset="utf-8" type="text/javascript"></script><a href="http://quanjing.cnzz.com" target="_blank" title="全景统计">全景统计</a>

<script src="http://s11.cnzz.com/z_stat.php?id=1260920820&amp;web_id=1260920820" language="JavaScript"></script><script src="http://c.cnzz.com/core.php?web_id=1260920820&amp;t=z" charset="utf-8" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=1260920820" target="_blank" title="站长统计">站长统计</a>

<script type="text/javascript">

//添加多种 cnzz 统计，ref = 相应ID 来源页统计， 如果来自统计来源，则每次访问页面 都要算上 统计来源的pv
(function(){
	var ref = get_request_param("ref");
	/* console.log("<<< ref : " + ref + " >>>"); */
	if(ref == undefined || ref == null || ref.length == 0) {
  		var  ref = cookie_get("xx_ref_number");
	}
	if (ref != undefined || ref != null || ref.length > 0) {
		if (ref == "1254545105"　||
				ref == "1253206752" ||
				ref == "1254132598" ||
				ref == "1254568791" ||
				ref == "1254399664" ||
				ref == "1253457897" ||
				ref == "1256432524" ||
				ref == "1255083622" ||
				ref == "1253991964" ||
				ref == "1253233964" ||
				ref == "1256609084" ||
				ref == "1253259895" ||
				ref == "1253031006" ||
				ref == "1252950557" ||
				ref == "1253259909" ||
				ref == "1253991964" ||
				ref == "30098537"   ||
				ref == "1253233972" ||
				ref == "1253316423" ||
				ref == "1253421799" ||
				ref == "1253991850" ||
				ref == "1254670176" ||
				ref == "1254631931" ||
				ref == "1255981186" ||
				ref == "1253991976" ||
				ref == "1256541076" ||
				ref == "1256432532"  ){
			document.write("<script type=\"text/javascript\" src=\"http://w.cnzz.com/c.php?id=" + ref + "&l=3\" language=\"JavaScript\" charset=\"gb2312\" async=\"true\"><\/script>");
		}
	}
})();

</script>
</div><script>
    $(function () {
        var $picList = $(".pic-list");
        var $body = $("body"),
                $header = $("#header"),
                $menu = $("#read-menu"),
                $showPage = $(".show-page");
        touch.on($("#scroller"), "tap", function () {
            if (!$body.hasClass("full")) {
                $header.addClass('hide');
                $menu.addClass('hide');
                $showPage.addClass('show');
                $body.addClass('full');
            } else {
                $header.removeClass('hide');
                $menu.removeClass('hide');
                $showPage.removeClass('show');
                $body.removeClass('full');
            }
        })
        touch.on( $("#ad"),"tap", function () {
            install();
            tongji(151);
        })
        touch.on($(".dialog-btn"),"tap",function(){
            install();
            tongji(158);
        })
        touch.on($(".center-box"),"tap",function(){
            if (!$body.hasClass("full")) {
                $header.addClass('hide');
                $body.addClass('full');
            } else {
                $header.removeClass('hide');
                $body.removeClass('full');
            }
        })
        $(".dialog-close").each(function (index, el) {
            touch.on($(this), "tap", function () {
                $(this).parents(".dialog-content").removeClass('show');
            });
        });
        var arr = [];
        $(".chapter-section").each(function (index) {
            var a = {};
            a.height = $(".chapter-section").eq(index).attr("data-height");
            a.width = $(".chapter-section").eq(index).attr("data-width");
            a.imgId = $(".chapter-section").eq(index).attr("imageId");
            a.chapterinfo = $(".chapter-section").eq(index).attr("chapterinfo");
            arr.push(a);
        })
        var comic_key = "124707";
        //保存每张图距离顶部的位置
        var imgOffsetTop = [];
        //保存每张图片的高度
        var imgHeight = [];
        //判断当前图片是第几张的限定位置
        var limit = 0.25;
        var maxBodyHeight = 40000;
        var screenHeight = window.screen.height;
        var screnWidth = document.body.clientWidth;
        $(window).resize(function (event) {
            screenHeight = window.screen.height;
            screnWidth = document.body.clientWidth;
        });
        var chapter_id = "570533";
        cookievalue = chapter_id + "|" ;
        setCookie(comic_key, cookievalue, 3600 * 24 * 30);
        //计算图片高度，ajax完成后执行，二次执行后追加，不能覆盖
        $(".chapter-section").each(function (index, el) {
            imgHeight[index] = parseInt((arr[index].height) / (arr[index].width) * screnWidth);
            $(this).children('img').css({
                "width": document.body.clientWidth,
                "height": imgHeight[index]
            })
        });
        //计算图片距离页面顶部距离，ajax完成后执行，二次执行后追加，不能覆盖
        $(".chapter-section").each(function (index, el) {
            imgOffsetTop[index] = parseInt($(this).offset().top);
        })

        function pushInfo(chapterId) {
            var imgHeightLegth = imgHeight.length;
            var imgOffsetTopLegth = imgOffsetTop.length;
            var beforeListHeight;
            $(".chapterid" + chapterId).children(".chapter-section").each(function (index, el) {
                imgHeight[imgHeightLegth + index] = parseInt(($(this).attr("data-height")) / ($(this).attr("data-width")) * screnWidth);
                $(this).children('img').css({
                    "width": screnWidth,
                    "height": imgHeight[imgHeightLegth + index]
                })
                imgOffsetTop[imgOffsetTopLegth + index] = parseInt($(this).offset().top);
            });
        }
        var $nextChapterId = "";
        $nextChapterId = "570534";
        touch.on($(".next-chapter"), "tap", function () {
            getchapter();
        })
        function getchapter() {
            tongji(152);
            var body_height = document.body.scrollHeight;
            var chapterId = $(".next-chapter").eq(-1).attr("id");
            if (body_height > maxBodyHeight && chapterId != undefined ) {
                $(".next-chapter").eq(-1).show();
                $(".next-chapter").eq(-1).attr("href","/r/"+chapterId+".html");
                return false;
            }
            //$(".next-chapter").remove();
            $.ajax({
                type: 'get',
                url: '/wap/comicChapter/getNextChapter',
                data: {chapter_id: $nextChapterId},
                dataType: "json",
                success: function (data) {
                    if (data['stateCode'] == 1) {
                        $(".show-page").addClass("show");
                        var html = "";
                        if (data['returnData']['comic']['comic_type'] == "1") {
                            html += '<ul class="pic-list noBorder chapterid' + data['returnData']['chapterNum']['nextChapterId'] + '">'
                        } else {
                            html += '<ul class="pic-list chapterid' + data['returnData']['chapterNum']['nextChapterId'] + '" >'
                        }
                        $image_list = data['returnData']['image_list'];
                        for (var i = 0; i < $image_list.length; i++) {
                            html += '<li class="chapter-section loadShow" ' +
                                    'chapterNum="' + data['returnData']['chapterNum']['num'] + '"' +
                                    ' chapterInfo="' + data['returnData']['title'] + '" ' +
                                    'picNum="' + i + '" ' +
                                    'total="' + $image_list.length + '" ' +
                                    'imageid="' + $image_list[i]['image_id'] + '" ' +
                                    'chapterid="' + data['returnData']['chapter_id'] + '"' +
                                    ' data-width="' + $image_list[i]['width'] + '"' +
                                    ' data-height="' + $image_list[i]['height'] + '">'
                            if(i>2){
                                html += '<img imageurl="' + $image_list[i]['location'] + '" alt="" src="" class="images">'
                            }else{
                                html += '<img imageurl="' + $image_list[i]['location'] + '"  src="' + $image_list[i]['location'] + '" alt="" class="images">'
                            }
                            html += '</li>'
                        }
                        if (data['returnData']['chapterNum']['nextChapterId']) {
                            html += '<li class="noBorder">'
                            if("1"){
                                html += '<img src="http://k.static.u17i.com/m/mobile2017/images/read_bottom.jpg" alt="" class="installApp">'
                            }
                            html += '<a href="javascript:" class="next-chapter" id="'+data['returnData']['chapterNum']['nextChapterId']+'" style="display: none" >点击进入下一章节</a>'
                            html += '</li>'
                        } else {
                            if("1"){
                                html += '<li class="noBorder">'
                                html += '<div id="ad"> <span  class="installApp"></span> </div>'
                                html += '<div class="noChapter"> '
                                if(data['returnData']['comic']['series_status'] == 1){
                                    html += '已完结，去看其他精彩作品吧！'
                                }else{
                                    html += '未完待续！'
                                }

                                html += '</div>'
                                html += '<div class="share-box">'
                                html += '<div class="sb-btn-box"> '
                                if (data['returnData']['comic']['is_fav'] == 'Y') {
                                    html += '<span class="sb-btn sb-collect"></span> <span class="fav">收藏</span> '
                                } else {
                                    html += '<span  class="sb-btn sb-collect collected"></span> <span class="fav">已收藏</span> '
                                }
                                html += '</div>'
                                html += '<div class="sb-btn-box"> <span class="sb-btn sb-share"></span> 分享 </div>'
                                html += '</div>'
                            }
                            html += '</li>'
                        }
                        html += '</ul>'
                        $(".cur-page").text(data['returnData']['title']);
                        $(".next-chapter").hide();
                        $("#scroller").append(html);
                        chapter_id = data['returnData']['chapter_id'];
                        cookievalue = chapter_id + "|" ;
                        setCookie(comic_key, cookievalue, 3600 * 24 * 30);
                        var $nc = $(".next-chapter").eq(-1);
                        touch.on($nc, 'tap', getchapter);
                        touch.on($("#ad"), 'tap', function(){
                            tongji(151);
                            install();

                        });
                        touch.on($(".installApp"),"tap",install)
                        touch.on($(".sb-share"),"tap",function(){
                            $(".share-content").show();
                            tongji(150);
                        })
                        touch.on($(".sb-collect"), "tap", function () {
                            $comicid = "124707";
                            fav("sb-collect", $comicid);
                            tongji(149);
                        });
                        $nextChapterId = data['returnData']['chapterNum']['nextChapterId'];
                        pushInfo($nextChapterId);
                    } else if (data['stateCode'] == -3 && "1") {
                        $("#header").removeClass("hide");
                        $("#read-menu").removeClass("hide");
                        var html = "";
                        html += '<div class="remind-pay-content center-box" style="display: block">'
                        html += '<div class="remind-pay-box">'
                        html += '<img src="http://k.static.u17i.com/m/mobile2017/images/remind_pay_yaoqiniang.png" class="remind-img">'
                        html += '<span class="comic-title">本章节需要 ' + data['returnData']['price']+' 妖气币</span>'
                        html += '<span data-href="/wap/buyChapter/buy?comicId=' + data['returnData']['comic']['comic_id'] + '&chapter=' + data['returnData']['chapter_id'] + '" class="comic-pay-btn">当前余额'+ data['returnData']['user_coin']+'妖气币  点此购买章节</span>'
                        html += '</div>'
                        html += '</div>'
                        $("#scroller").append(html);

                        touch.on($(".comic-pay-btn")[0], "tap", function () {
                            buychapter($(this).attr("data-href"));
                        })
                        $(".cur-page").text(data['returnData']['title']);
                        $(".show-page").removeClass("need");

                    } else if (data['stateCode'] == -5 && "1") {
                        $("#header").removeClass("hide");
                        $("#read-menu").removeClass("hide");
                        var html = "";
                        html += '<div class="remind-pay-content center-box" style="display: block">'
                        html += '<div class="remind-pay-box">'
                        html += '<img src="http://k.static.u17i.com/m/mobile2017/images/remind_pay_yaoqiniang.png" class="remind-img">'
                        html += '<span class="comic-title">前方会员专属章节出没！</span>'
                        html += '<a data-href="/wap/Pay/vipPay" class="comic-pay-btn">' + data['message'] + '</a>'
                        html += '</div>'
                        html += '</div>'
                        $("#scroller").append(html);
                        touch.on($(".comic-pay-btn")[0], "tap", function () {
                            window.location.href = $(this).attr("data-href");
                        })
                        $(".cur-page").text(data['returnData']['title']);
                        $(".show-page").removeClass("need");

                    }else if((data['stateCode'] == -2 || data['stateCode'] == -4) && "1"){
                        $(".next-chapter").eq(-1).show();
                        $(".next-chapter").eq(-1).attr("href","/Wap/login/login?type=chapter&param="+data['returnData']['chapter_id']);
                    }
                }

            })
        }
        var old_chapter_id = 0;
        var re_set_url = function(chapter_id) {
	    if (chapter_id == old_chapter_id) {
		    return false;
	    }
	    if (window.history.pushState && window.history.replaceState) {
                window.history.replaceState({}, null, chapter_id+'.html');
		        old_chapter_id = chapter_id;
                console.log(old_chapter_id);
            }
        };

        touch.on($("#buychapter"), "tap", function () {
            url = $(this).attr("data-href");
            buychapter(url);
        })
        function buychapter(url) {
            tongji(155);
            $.ajax({
                type: 'get',
                url: url,
                dataType: "json",
                success: function (data) {
                    if (data['data']['stateCode'] == -2 && data['code'] == 1) {
                        window.location.href="/wap/pay/coinpay";
                    } else if (data['code'] == 1 && data['data']['stateCode'] == 1) {
                        window.location.href = "/r/" + data['data']['returnData']['successChapter']+".html";
                    }
                },
                error: function (data) {
                    alert("网路请求异常");
                }
            });


        }
        touch.on($(".download1-btn"), "tap", function () {
            $(".download2").addClass("show");
            tongji(157);
        })
        touch.on($(".download2-btn"), "tap", function () {
            $(".download1").addClass("show");
            tongji(159);
        })
        touch.on($(".sb-collect"), "tap", function () {
            $comicid = "124707";
            fav("sb-collect", $comicid,chapter_id);
            tongji(149);
        })
        touch.on($(".collect-btn"), "tap", function () {
            $comicid = "124707";
            fav("collect-btn", $comicid,chapter_id);
            tongji(153);
        })
        function fav($class, $comicid,$chapterid) {
            timestamp = (new Date()).valueOf();
            if ($("." + $class).hasClass("collected")) {
                $data = $comicid + '|delete|' + timestamp + '|1';
                $.ajax({
                    type: 'post',
                    url: '/wap/fav/index',
                    data: {data: $data},
                    dataType: "json",
                    success: function (data) {
                        if (data == 1) {
                            $(".collect-btn").removeClass("collected");
                            $(".sb-collect").removeClass("collected");
                            $(".fav").text("收藏");
                        }
                        if (data == "NoLogin") {
                            window.location.href="/Wap/login/login?type=chapter&param="+$chapterid;
                        }
                    }
                });
            } else {
                $data = $comicid + '|add|' + timestamp + '|1';
                $.ajax({
                    type: 'post',
                    url: '/wap/fav/index',
                    data: {data: $data},
                    dataType: "json",
                    success: function (data) {
                        if (data == 1) {
                            $(".collect-btn").addClass("collected");
                            $(".sb-collect").addClass("collected");
                            $(".fav").text("已收藏");
                        }
                        if (data == "NoLogin") {
                            window.location.href="/Wap/login/login?type=chapter&param="+$chapterid;
                        }
                    }
                });
            }
        }

        touch.on($(".installApp"),"tap",function(){
            install();
        })
        function install() {
            // 默认地址
            var url = "http://a.app.qq.com/o/simple.jsp?pkgname=com.u17.comic.phone";
            var u = navigator.userAgent, app = navigator.appVersion;
            var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //android终端或者uc浏览器
            var isIOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端

            if (isAndroid) {
                url = "http://a.app.qq.com/o/simple.jsp?pkgname=com.u17.comic.phone";
            } else if (isIOS) {
                url = "http://um0.cn/30sZok";
            }
            window.location.href = url;
        }
        var lastID="";
        var n=0;
        var image_load_timer = '';
        $(window).scroll(function(){
            var st = document.body.scrollTop;

            for (var i = 0; i < imgOffsetTop.length; i++) {
                //st 当前距离顶部高度  + 浏览器高度 > 图片距离顶部高度 + 图片高度 * 比例 && 当前距离顶部高度 + 浏览器高度 <
                if (st + screenHeight > imgOffsetTop[i] + imgHeight[i] * limit && st + screenHeight < imgOffsetTop[i + 1] + imgHeight[i + 1] * limit) {
                    updateChapterInfo(i);
                    break;
                } else if (!imgOffsetTop[i + 1]) {
                    updateChapterInfo(i);
                    break;
                }
            }
            clearTimeout(image_load_timer);
            image_load_timer = window.setTimeout(function() {
                for (var i = 0; i < imgOffsetTop.length; i++) {

                    if(imgOffsetTop.length < 4){
                        if(lastID != $nextChapterId){
                            getchapter();
                            lastID = $nextChapterId;
                        }
                    }

                    if (i >= imgOffsetTop.length - 6 && lastID != $nextChapterId) {
                        getchapter();
                        lastID = $nextChapterId;
                    }

                    $("#header").addClass("hide");
                    $("#read-menu").addClass("hide");
                    $showPage.addClass('show');
                    $body.addClass('full');
                    if (st + screenHeight > imgOffsetTop[i] + imgHeight[i] * limit && st + screenHeight < imgOffsetTop[i + 1] + imgHeight[i + 1] * limit) {
                        var loadNowImg = i;
                        if (loadNowImg > 0 ) {
                            loadNowImg = loadNowImg - 1;
                        }
                        loadImage(loadNowImg)
                        break;
                    } else if (!imgOffsetTop[i + 1]) {
                        var loadNowImg = i;
                        if (loadNowImg > 0 ) {
                            loadNowImg = loadNowImg - 1;
                        }
                        loadImage(loadNowImg)
                        break;
                    }

                }
            },100)
        })
        var imageNum =0;
        function updateChapterInfo(i) {
            var curImg = $(".chapter-section").eq(i);
            $(".cur-page").text(curImg.attr("chapterinfo"));
            re_set_url(curImg.attr("chapterid"));
            picNum = parseInt(curImg.attr("picNum")) + 1;
            var html = "";
            html += '<span>' + curImg.attr("chapternum") + '</span>话:'
            html += '<span class="page-num">' + picNum + '/' + curImg.attr("total") + '</span>'
            $(".show-page").html(html);
        }
        /***************************************************************************/
        /*当前图片id*/
        var load_image_id = 0;

        /*当前加载图片数量*/
        var load_num = 0;

        /*最大图片加载数量*/
        var load_max = 5;

        /*加载图片队列数组*/
        var load_queue = [];
        /*延时加载列表*/
        var imgLoadPrepare = [];

        var isImageLoadTime = 'Y';
        var imgLoadTimes = [];
        function loadImage(i) {
            var images = $(".images").eq(i);
            //立即加载列表
            var image_load = [];
            var m = i;
            for (var j = 0; j <= 2; j++) {
                if (m < 0) {
                    break;
                }
                if (!$(".images").eq(m).attr('src') && $('.images').eq(m).attr('imageurl') && $('.images').eq(m).attr('imageurl').length > 0) {
                    imgLoadPrepare.push($(".images").eq(m));
                }
                m --;
            }

            m = i;
            for (var j = 0; j <= 4; j++) {
                if (!$(".images").eq(m).attr('src') && $('.images').eq(m).attr('imageurl') && $('.images').eq(m).attr('imageurl').length > 0) {
                    image_load.push($(".images").eq(m));
                }
                m++;
            }

            loadImgById(image_load);

            //当前图片下面没有可加载图片时触发
            if (!image_load.length) {
                loadWaitingImg();
            }
        }

        function loadImgById(imgs) {
            for (var i = 0, img; img = imgs[i]; i++) {
                loadImg(img);
            }
        }

        var load_queue_list = [];

        var loadImg = function (img) {
            var src = img.attr('imageurl');
            var image_id = img.parent().attr('imageid');

            var timeout = window.setTimeout((function (img) {
                return function () {
                    imgLoadErr(img);
                };
            })(img), 10000)


            // 绑定加载事件
            img.off('load').on('load', function () {
                loadOk(img);
            }).off('error').on('error', function () {
                load_queue_list.splice(load_queue_list.indexOf(image_id), 1);
                imgLoadErr(img);
            });

            img.attr('src', src);
            img.attr('data-timeout', String(timeout));
            // 记入加载中的队列
            if (load_queue_list.indexOf(image_id) < 0) {
                load_queue_list.push(image_id);
            }

        };

        /*图片加载失败*/
        imgLoadErr = function(img) {
            img.parent().removeClass('loadShow').addClass('loadingPic');

            touch.on(img.parent(), 'tap', function(){
                reLoadImg(img);
            });

            var image_id = img.parent().attr('imageid');
            var timeout = img.attr('data-timeout');
            timeout && window.clearTimeout(Number(timeout));
            img.attr('data-timeout', '');

        }

        /*重新加载图片*/
        reLoadImg = function (img) {
            var src = img.attr('imageurl'),
                    now = new Date().getTime(),
                    gl = src.indexOf('?') < 0 ? '?' : '&';

            src = src + gl + 't=' + now;

            img.parent().removeClass('loadingPic');
            img.parent().addClass('loadShow');
            img.attr('src', '');
            var newImg = img.clone();
            img.before(newImg);
            newImg.attr('imageurl', src);
            img.remove();
            img.empty();
            loadImg(newImg);
        }


        // 加载等待中的图片
        var loadWaitingImg = function () {
            var imgLoadPrepareAre = imgLoadPrepare;
            imgLoadPrepare = [];
            loadImgById(imgLoadPrepareAre.reverse());
        };

        /**
         * 图片加载完成
         * @param  {[type]} src [description]
         * @param  {[type]} image_id [description]
         * @return {[type]}     [description]
         */
        var loadOk = function (img) {
            var image_id = img.parent().attr('imageid');
            var timeout = img.attr('data-timeout');
            timeout && window.clearTimeout(Number(timeout));
            img.attr('data-timeout', '');
            img.parent().removeClass('loadingPic').removeClass('loadShow');

            if (load_queue_list.indexOf(image_id) >= 0) {
                load_queue_list.splice(load_queue_list.indexOf(image_id), 1);
            }

            //查看队列中是否存在未加载完成的图片
            if (!load_queue_list.length) {
                loadWaitingImg();
            }
        };



        //设置cookie
        function setCookie(name, value, seconds) {
            seconds = seconds || 0; //seconds有值就直接赋值，没有为0，这个根php不一样。
            var expires = "";
            if (seconds != 0) { //设置cookie生存时间
                var date = new Date();
                date.setTime(date.getTime() + (seconds * 1000));
                expires = "; expires=" + date.toGMTString();
            }
            document.cookie = name + "=" + escape(value) + expires + "; path=/"; //转码并赋值
        }

        /**************************************************************************************************************/
        touch.on($(".sb-share"),"tap", function () {
            $(".share-content").show();
            tongji(150);
        })
        touch.on($(".share-close"),"tap",function(){
            $(".share-content").hide();
        })
        touch.on($("#qq"),"tap",function(){
            qzone();
        })
        touch.on($("#friend"),"tap",function(){
            mqq();
        })
        touch.on($("#weibo"),"tap",function(){
            weibo();
        })
        var globalSourceUrl = "http://www.u17.com";
        var globalSourceMess = "有妖气（www.u17.com）";
        var globalWeiboClientId = "2423174220";

        /* FIXME 指定了固定的分享页面，应该是当前页面 */
        //var globalShareUrl = "http://m.u17.com";
        var globalShareUrl = "http://m.u17.com/c/124707.html";
        var globalReason = "~漫画太好看，根本停不下来~";
        var globalTitle = "~有妖气，为世界带来爱~";
        var globalIntro = "有妖气，为世界带来爱','有妖气（www.u17.com）为中国最大的独立原创漫画网络平台，汇聚了近万名漫画家、数万部漫画作品与近百万读者。";

        var base64 = new Base64();
        /* 分享至QQ空间 */
        function qzone(url,reason,title,intro,pic,source) {
            /* 分享接口地址 */
            var shareUrl = "http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?";

            /* 参数值判断 */
            if(url == null || url == undefined || url.length <= 0) {
                url=globalShareUrl;
            }

            if(reason == null || reason == undefined || reason.length <= 0) {
                reason = globalReason;
            }

            if(title == null || title == undefined || title.length <= 0) {
                title = globalTitle;
            }

            if(intro == null || intro == undefined || intro.length <= 0) {
                intro = globalIntro;
            }

            if(pic == null || pic == undefined || pic.length <= 0) {
                pic = '';
            }

            if(source == null || source == undefined || source.length <= 0) {
                source = globalSourceMess;
            }

            /* 接口参数 */
            var p = {
                url : url,		/* 分享的网址 */
                showcount : '1',	/* 是否显示分享总数,显示：'1'，不显示：'0' */
                desc : reason,	/* 用户 默认分享网页理由(可选) */
                title : title,	/* 分享网页标题(可选) */
                summary : intro,	/* 分享网页的简介(可选) */
                pics : pic, 	/* 分享图片的路径(可选) */
                site : source	/* 分享来源 如：腾讯网(可选) */
            };

            /* 组装完整接口地址 */
            var s = [];
            for ( var i in p) {
                s.push(i + '=' + encodeURIComponent(p[i] || ''));
            }
            s = s.join('&');
            shareUrl += s;

            /* 在新窗口打开分享界面 */
            /* window.open(shareUrl); */
            /* 在当前窗口打开分享界面 */
            window.location.href = shareUrl;
        }

        /* 分享至QQ好友（mobile web） */
        function mqq(url,title,intro,source) {
            var shareUrl = "mqqapi://share/to_fri?";

            /* 参数值判断 */
            if(url == null || url == undefined || url.length <= 0) {
                url = base64.encode(globalShareUrl);
                url = "aHR0cDovL3d3dy51MTcuY29t";
            }

            if(title == null || title == undefined || title.length <= 0) {
                title = base64.encode(globalTitle);
                title = "fuacieWmluawlO+8jOS4uuS4lueVjOW4puadpeeIsX4=";
            }

            if(intro == null || intro == undefined || intro.length <= 0) {
                intro = base64.encode(globalIntro);
                intro = "5pyJ5aaW5rCU77yM5Li65LiW55WM5bim5p2l54ixJywn5pyJ5aaW5rCU77yId3d3LnUxNy5jb23vvInkuLrkuK3lm73mnIDlpKfnmoTni6znq4vljp/liJvmvKvnlLvnvZHnu5zlubPlj7DvvIzmsYfogZrkuobov5HkuIflkI3mvKvnlLvlrrbjgIHmlbDkuIfpg6jmvKvnlLvkvZzlk4HkuI7ov5Hnmb7kuIfor7vogIXjgII=";
            }

            if(source == null || source == undefined || source.length <= 0) {
                source = base64.encode(globalSourceMess);
                source = "fuacieWmluawlO+8jOS4uuS4lueVjOW4puadpeeIsX4=";
            }
            /* 接口参数 */
            var p = {
                file_type : 'news',
                src_type : 'web',
                version : '1',
                share_id : '1101685683', /*  FIXME 需要申请 appid，暂时使用的是起点中文网的appid  */
                url : url,		/* 分享的网址 */
                title : title,	/* 分享网页标题 */
                description : intro,	/* 分享网页内容描述 */
                thirdAppDisplayName : source
            };

            /* 组装完整接口地址 */
            var s = [];
            for ( var i in p) {
                s.push(i + '=' + encodeURIComponent(p[i] || ''));
            }
            s = s.join('&');
            shareUrl += s;


            /* 在新窗口打开分享界面 */
            /* window.open(shareUrl); */
            /* 在当前窗口打开分享界面 */
            window.location.href = shareUrl;
        }

        /* 分享至新浪微博 */
        function weibo(url,title,pic,source) {

            /* 分享接口地址 */
            var shareUrl = "http://service.weibo.com/share/share.php?";

            /* 参数值判断 */
            if(url == null || url == undefined || url.length <= 0) {
                url = globalShareUrl;
            }

            if(title == null || title == undefined || title.length <= 0) {
                title = globalTitle;
            }

            if(pic == null || pic == undefined || pic.length <= 0) {
                pic = '';
            }

            if(source == null || source == undefined || source.length <= 0) {
                source = globalWeiboClientId;
            }

            /* 接口参数 */
            var p = {
                url : url,		/* 分享的网址 */
                count: 1,		/* 是否显示分享总数,显示：'1'，不显示：'0' */
                title : title,	/* 分享网页标题(可选) */
                pic : pic, 	/* 分享图片的路径(可选) */
                ralateUid : '',		/* 转发时会@相关的微博账号(可选，允许为空) */
                language : 'zh_cn',		/* 语言设置(zh_cn|zh_tw)(可选) */
                appkey : source,	/* 用于发布微博的来源显示,如 1343713053，为空则分享的内容来源会显示来自互联网。(可选，允许为空) */
                type : 'button',
                searchPic : false,
                style : 'simple'
            };

            /* 组装完整接口地址 */
            var s = [];
            for ( var i in p) {
                s.push(i + '=' + encodeURIComponent(p[i] || ''));
            }
            s = s.join('&');
            shareUrl += s;

            /* 在新窗口打开分享界面 */
            /* window.open(shareUrl); */
            /* 在当前窗口打开分享界面 */
            window.location.href = shareUrl;
        }

        var st = document.body.scrollTop;
        for (var i = 0; i < imgOffsetTop.length; i++) {
            if(imgOffsetTop.length < 4){
                if(lastID != $nextChapterId){
                    getchapter();
                    lastID = $nextChapterId;

                }
            }
            if (st + screenHeight > imgOffsetTop[i] + imgHeight[i] * limit && st + screenHeight < imgOffsetTop[i + 1] + imgHeight[i + 1] * limit) {
                updateChapterInfo(i);
                loadImage(i);
                break;
            } else if (!imgOffsetTop[i + 1]) {
                updateChapterInfo(i);
                loadImage(i)
                break;
            }
        }

    })


</script>

<script type="text/javascript">
    var img = document.getElementsByTagName("img");
    function imgStop(){
        for (var i = 0; i < img.length; i++) {
            img[i].addEventListener('touchend',function(e){
                e.preventDefault();
            },false);
        };
    };
    imgStop();
    $("body").bind('DOMNodeInserted', function(e) {
        imgStop();
    });
</script>


</body></html>