<html><head></head><body><pre style="word-wrap: break-word; white-space: pre-wrap;">define("controller-inoutflow",["jquery","underscore","backbone"],function(t,e,o){return eye.FlowController=Backbone.View.extend({el:"#content_container",tv_id:"",tv_name:"",initialize:function(){this.tv_id=window.location.hash.split("/")[1],this.tv_name=decodeURIComponent(window.location.hash.split("/")[2]),this.flowInfo(),t(window).on("hashchange",function(){eye.flowModel.set("flow_inout",[]),eye.flowModel.flowAjax&amp;&amp;eye.flowModel.flowAjax.abort(),eye.flowModel.flowAjax=null})},events:{"click .gohome":"goHome","click .realline":"goRealTime","click .flowinout":"goFlow","click .epginfo":"goEpgList"},goHome:function(){general.goHome()},goRealTime:function(){window.location.href="#real/detail/"+window.location.hash.split("/").slice(-2).join("/")},goEpgList:function(){window.location.href="#epglist/"+window.location.hash.split("/").slice(-2).join("/")},goFlow:function(){window.location.href="#flow/"+window.location.hash.split("/").slice(-2).join("/")},flowInfo:function(){var t={tv_id:this.tv_id};eye.flowModel.getFlow(t)}}),eye.FlowController}),define("model-inoutflow",["jquery","underscore","backbone","tools","urlhelper"],function(t,e,o){return eye.FlowModel=Backbone.Model.extend({defaults:{flow_inout:{}},initialize:function(){},getFlow:function(t){tools.showLoading();var e=this,o={};t&amp;&amp;(o=t),tools.getAjax(eye.urlHelper.requests.flowinout,o,function(t){t.status?e.set("flow_inout",t.data):layer.open({content:"加载失败,请刷新重试...",time:2}),tools.hideLoading()},function(t){general.requireTip(t)})}}),eye.FlowModel}),define("m-view-inoutflow",["jquery","underscore","backbone","echarts","tools","controller-inoutflow","model-inoutflow"],function(t,e,o,n){return eye.FlowView=Backbone.View.extend({el:"#content_container",flowChart:"",initialize:function(){t("#content_container").empty().append('&lt;div class="flow_container"&gt;&lt;/div&gt;');var e=t("#epgatten_top").html(),o=t("#flowchart_box").html();t(".flow_container").empty().append(e),t(".flow_info").remove(),t(".flow_container").append(o),t("#content_container .ch_name").html(eye.flowController.tv_name),t(".helplink").remove(),t(".flowinout").addClass("current"),this.listenTo(eye.flowModel,"change:flow_inout",this.render),this.flowChart=n.init(document.getElementById("flowchart"))},render:function(){var o=this,i=eye.flowModel.get("flow_inout").list;if(i){var l=e.last(i),a=(100*l.tv_ratings).toFixed(4),s=l.time_stamp,r=tools.dateFormat(tools.transDate(s),"MM-dd hh:mm:ss");t(".ftime").html(r),t(".fatten").html(a+"%");var d=e.pluck(i,"tv_ratings"),c=e.pluck(i,"time_stamp"),f=e.first(c),u=e.last(c),p=eye.flowModel.get("flow_inout").high_low,w={input:e.filter(p,function(t){return t.start_y&lt;=t.end_y}),output:e.filter(p,function(t){return t.start_y&gt;t.end_y})},h=function(o){var n=[],i=o.input,l=tools.dateFormat(tools.transDate(o.start_x),"hh:mm"),a=tools.dateFormat(tools.transDate(o.end_x),"hh:mm"),s=[],r=o.output;n.push('&lt;dt&gt;&lt;span class="fr"&gt;'+(100*o.in).toFixed(4)+"%&lt;/span&gt;流入 ("+l+"~"+a+")&lt;/dt&gt;"),e.each(i,function(t,e){void 0==t.epg_name?n.push('&lt;dd&gt;&lt;span class="fr"&gt;'+(100*t.value).toFixed(4)+'%&lt;/span&gt;&amp;nbsp;&lt;span class="fl"&gt;'+(e+1)+".&amp;nbsp;"+t.channel+"&lt;/span&gt;&lt;/dd&gt;"):n.push('&lt;dd&gt;&lt;span class="fr"&gt;'+(100*t.value).toFixed(4)+'%&lt;/span&gt;&lt;span class="secspan fl"&gt;'+(e+1)+".&amp;nbsp;"+t.channel+'&lt;/span&gt;&lt;i class="fl"&gt;'+(t.epg_name?t.epg_name:"-")+"&lt;/i&gt;&lt;/dd&gt;")}),s.push('&lt;dt&gt;&lt;span class="fr"&gt;'+(100*o.out).toFixed(4)+"%&lt;/span&gt;流出 ("+l+"~"+a+")&lt;/dt&gt;"),e.each(r,function(t,e){void 0==t.epg_name?s.push('&lt;dd&gt;&lt;span class="fr"&gt;'+(100*t.value).toFixed(4)+'%&lt;/span&gt;&amp;nbsp;&lt;span class="fl"&gt;'+(e+1)+".&amp;nbsp;"+t.channel+"&lt;/span&gt;&lt;/dd&gt;"):s.push('&lt;dd&gt;&lt;span class="fr"&gt;'+(100*t.value).toFixed(4)+'%&lt;/span&gt;&lt;span class="secspan fl"&gt;'+(e+1)+".&amp;nbsp;"+t.channel+'&lt;/span&gt;&lt;i class="fl"&gt;'+(t.epg_name?t.epg_name:"-")+"&lt;/i&gt;&lt;/dd&gt;")}),t(".flowlist dl.clist1").html(n.join("")),t(".flowlist dl.clist4").html(s.join(""))};h(p[0]);var m={animation:!1,grid:{x:0,y:10,x2:0,y2:35,borderWidth:0},tooltip:{backgroundColor:"rgba(0, 0, 0, 0)",trigger:"axis",showDelay:0,padding:10,textStyle:{color:"#fff",decoration:"none",fontSize:14},axisPointer:{lineStyle:{color:"#041733",width:2}},formatter:function(t,o,n){var i=tools.transDate(t[0].name),l=e.find(p,function(t){return tools.transDate(t.start_x+"")&lt;=i&amp;&amp;i&lt;tools.transDate(t.end_x+"")});return l&amp;&amp;h(l),""}},legend:{x:"5",y:"13",selectedMode:!1,textStyle:{color:"#aab2bb",fontSize:14},icon:"rectangle",itemHeight:6,itemWidth:6},xAxis:[{type:"category",boundaryGap:!1,axisLabel:{interval:9,textStyle:{color:"#aab2bb"},formatter:function(t){return t==f||t==u?"":tools.dateFormat(tools.transDate(t),"hh:mm")}},splitLine:{show:!0,lineStyle:{color:"#535d7e",width:1}},axisTick:{show:!1,interval:"auto"},axisLine:{show:!1},data:[]}],yAxis:[{type:"value",position:"right",precision:6,scale:!0,splitNumber:2,axisLabel:{formatter:function(t){return t=parseFloat(t),t?(100*t).toFixed(4)+"%":"0"},textStyle:{align:"right",color:"#aab2bb",marginRight:"10"},margin:-2},splitLine:{show:!0,lineStyle:{color:"#535d7e",width:1}},axisTick:{show:!1},axisLine:{lineStyle:{color:"#535d7e",width:2}}}],series:[{type:"line",smooth:!0,symbol:"none",itemStyle:{normal:{color:"#57beff",lineStyle:{color:"#57beff",width:0},areaStyle:{color:"rgba(255, 255, 255, 0.15)"}}},data:[]}]},y=function(t){var o=t?"input":"output",n={input:"#23dbff",output:"#ffbf34"},i={name:t?"流入":"流出",type:"line",itemStyle:{normal:{color:n[o]}},data:[],markLine:{tooltip:{show:!0,trigger:"item",formatter:function(t){return""}},lineStyle:{normal:{type:"solid",color:n[o],width:2}},itemStyle:{normal:{color:n[o]}},data:e.map(w[o],function(t,e){return[{xAxis:t.start_x,yAxis:t.start_y},{xAxis:t.end_x,yAxis:t.end_y}]})}};return i};m.xAxis[0].data=c,m.series[0].data=d,m.series.push(y(!0)),m.series.push(y(!1)),m.legend.data=["流入","流出"],o.flowChart.setOption(m),window.onresize=function(){document.getElementById("flowchart")&amp;&amp;(o.flowChart=n.init(document.getElementById("flowchart")),o.flowChart.setOption(m))}}}}),eye.FlowView});</pre></body></html>